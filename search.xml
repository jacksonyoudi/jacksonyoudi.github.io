<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>goçˆ¬è™«æ¡†æ¶collyæºç ä»¥åŠè½¯ä»¶æ¶æ„åˆ†æ</title>
      <link href="/2021/08/01/colly/"/>
      <url>/2021/08/01/colly/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/6hvTNM.jpg"></p><p>æ— æ„ä¸­å‘ç°äº†<code>colly</code>,æˆ‘ä¸€ç›´æ˜¯ä½¿ç”¨pythonè¿›è¡Œçˆ¬è™«çš„ï¼Œ å­¦ä¹ golangçš„ä½¿ç”¨ï¼Œ ç”¨<code>go</code>å‚è€ƒ<code>scrapy</code>æ¶æ„å†™äº†ä¸€ä¸ªçˆ¬è™«çš„æ¡†æ¶demoã€‚æˆ‘ä¸€ç›´ä»¥ä¸ºgoä¸é€‚åˆåšçˆ¬è™«ï¼Œ goçš„é¢†åŸŸæ˜¯åç«¯æœåŠ¡ã€‚ç„¶åå»æœç´¢äº†ä¸€ä¸‹<code>colly</code>, å‘ç°è¿˜æ˜¯å¾ˆæµè¡Œã€‚ æˆ‘ä¸ªäººè¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢çˆ¬è™«ï¼Œ ç½‘ç»œä¸Šçš„æ•°æ®å°±æ˜¯å…¬å¼€çš„APIï¼Œ æ‰€ä»¥ï¼Œ çˆ¬è™«å»è¯·æ±‚æ¥å£è·å–æ•°æ®ã€‚å½“ç„¶æˆ‘æ˜¯éµå¾ªå›å­åè®®çš„ã€‚</p><p>å¥½ï¼Œ ä¸‹é¢è¿›å…¥æ­£é¢˜ï¼Œä»‹ç»<code>colly</code></p><h3 id="collyä»‹ç»"><a href="#collyä»‹ç»" class="headerlink" title="collyä»‹ç»"></a>collyä»‹ç»</h3><p><code>Lightning Fast and Elegant Scraping Framework for Gophers</code></p><p><code>Colly provides a clean interface to write any kind of crawler/scraper/spider.</code><br>å®˜æ–¹çš„ä»‹ç»ï¼Œgocollyå¿«é€Ÿä¼˜é›…ï¼Œåœ¨å•æ ¸ä¸Šæ¯ç§’å¯ä»¥å‘èµ·1Kä»¥ä¸Šè¯·æ±‚ï¼›ä»¥å›è°ƒå‡½æ•°çš„å½¢å¼æä¾›äº†ä¸€ç»„æ¥å£ï¼Œå¯ä»¥å®ç°ä»»æ„ç±»å‹çš„çˆ¬è™«ï¼›ä¾èµ–goqueryåº“å¯ä»¥åƒjqueryä¸€æ ·é€‰æ‹©webå…ƒç´ ã€‚</p><h3 id="å®‰è£…ä½¿ç”¨"><a href="#å®‰è£…ä½¿ç”¨" class="headerlink" title="å®‰è£…ä½¿ç”¨"></a>å®‰è£…ä½¿ç”¨</h3><p><a href="https://github.com/gocolly/colly">colly</a><br><a href="http://go-colly.org/">å®˜ç½‘</a></p><pre class="line-numbers language-none"><code class="language-none">go get -u github.com/gocolly/colly/...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"github.com/gocolly/colly"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ¶æ„ç‰¹ç‚¹"><a href="#æ¶æ„ç‰¹ç‚¹" class="headerlink" title="æ¶æ„ç‰¹ç‚¹"></a>æ¶æ„ç‰¹ç‚¹</h3><p>äº†è§£çˆ¬è™«çš„éƒ½çŸ¥é“ä¸€ä¸ªçˆ¬è™«è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</p><blockquote><ol><li>æ„å»ºè¯·æ±‚</li><li>å‘é€è¯·æ±‚</li><li>è·å–æ–‡æ¡£æˆ–æ•°æ®</li><li>è§£ææ–‡æ¡£æˆ–æ¸…æ´—æ•°æ®</li><li>æ•°æ®å¤„ç†æˆ–æŒä¹…åŒ–</li></ol></blockquote><p>scrapyçš„è®¾è®¡ç†å¿µæ˜¯å°†ä¸Šé¢çš„æ¯ä¸€ä¸ªæ­¥éª¤æŠ½ç¦»å‡ºæ¥ï¼Œç„¶ååšå‡ºç»„ä»¶çš„å½¢å¼ï¼Œ æœ€åé€šè¿‡è°ƒåº¦ç»„æˆæµæ°´çº¿çš„å·¥ä½œå½¢å¼ã€‚<br>æˆ‘ä»¬çœ‹ä¸€ä¸‹scrapyçš„æ¶æ„å›¾ï¼Œ è¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»ä¸‹ï¼Œ åé¢æœ‰æ—¶é—´ï¼Œæˆ‘æ·±å…¥ä»‹ç»scrapy<br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/0kfy9f.jpg" alt="0kfy9f"></p><p>å¦‚å›¾ï¼Œ<code>downloader</code>è´Ÿè´£è¯·æ±‚è·å–é¡µé¢ï¼Œ<code>spiders</code>ä¸­å†™å…·ä½“è§£ææ–‡æ¡£çš„é€»è¾‘ï¼Œ<code>item PipeLine</code>æ•°æ®æœ€åå¤„ç†ï¼Œ ä¸­é—´æœ‰ä¸€äº›ä¸­é—´ä»¶ï¼Œå¯ä»¥ä¸€äº›åŠŸèƒ½çš„è£…é¥°ã€‚æ¯”å¦‚ï¼Œä»£ç†ï¼Œè¯·æ±‚é¢‘ç‡ç­‰ã€‚</p><p>æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹collyçš„æ¶æ„ç‰¹ç‚¹<br>collyçš„é€»è¾‘æ›´åƒæ˜¯é¢å‘è¿‡ç¨‹ç¼–ç¨‹çš„ï¼Œ collyçš„é€»è¾‘å°±æ˜¯æŒ‰ä¸Šé¢ç”Ÿå‘½å‘¨æœŸçš„é¡ºåºç®¡é“å¤„ç†ï¼Œ åªæ˜¯åœ¨ä¸åŒé˜¶æ®µï¼ŒåŠ ä¸Šå›è°ƒå‡½æ•°è¿›è¡Œè¿‡æ»¤çš„æ—¶å€™è¿›è¡Œå¤„ç†ã€‚<br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/IS4YSc.jpg"></p><p>ä¸‹é¢ä¹ŸæŒ‰ç…§è¿™ä¸ªé€»è¾‘è¿›è¡Œä»‹ç»</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>å…ˆç»™ä¸€ä¸ªğŸŒ°</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"github.com/gocolly/colly"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// Instantiate default collector</span>c <span class="token operator">:=</span> colly<span class="token punctuation">.</span><span class="token function">NewCollector</span><span class="token punctuation">(</span><span class="token comment">// Visit only domains: hackerspaces.org, wiki.hackerspaces.org</span>colly<span class="token punctuation">.</span><span class="token function">AllowedDomains</span><span class="token punctuation">(</span><span class="token string">"hackerspaces.org"</span><span class="token punctuation">,</span> <span class="token string">"wiki.hackerspaces.org"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token comment">// On every a element which has href attribute call callback</span>c<span class="token punctuation">.</span><span class="token function">OnHTML</span><span class="token punctuation">(</span><span class="token string">"a[href]"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>colly<span class="token punctuation">.</span>HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>link <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token comment">// Print link</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Link found: %q -&gt; %s\n"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> link<span class="token punctuation">)</span><span class="token comment">// Visit link found on page</span><span class="token comment">// Only those links are visited which are in AllowedDomains</span>c<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">AbsoluteURL</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// Before making a request print "Visiting ..."</span>c<span class="token punctuation">.</span><span class="token function">OnRequest</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token operator">*</span>colly<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Visiting"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// Start scraping on https://hackerspaces.org</span>c<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span><span class="token string">"https://hackerspaces.org/"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯å®˜æ–¹ç»™çš„ç¤ºä¾‹ï¼Œ å¯ä»¥çœ‹åˆ°<code>colly.NewCollector</code>åˆ›å»ºä¸€ä¸ª<code>æ”¶é›†å™¨</code>ï¼Œ collyçš„æ‰€æœ‰å¤„ç†é€»è¾‘éƒ½æ˜¯ä»¥<code>Collector</code>ä¸ºæ ¸å¿ƒè¿›è¡Œæ“ä½œçš„ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>Collector</code>ç»“æ„ä½“çš„å®šä¹‰</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Collector provides the scraper instance for a scraping job</span><span class="token keyword">type</span> Collector <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token comment">// UserAgent is the User-Agent string used by HTTP requests</span>UserAgent <span class="token builtin">string</span><span class="token comment">// MaxDepth limits the recursion depth of visited URLs.</span><span class="token comment">// Set it to 0 for infinite recursion (default).</span>MaxDepth <span class="token builtin">int</span><span class="token comment">// AllowedDomains is a domain whitelist.</span><span class="token comment">// Leave it blank to allow any domains to be visited</span>AllowedDomains <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token comment">// DisallowedDomains is a domain blacklist.</span>DisallowedDomains <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token comment">// DisallowedURLFilters is a list of regular expressions which restricts</span><span class="token comment">// visiting URLs. If any of the rules matches to a URL the</span><span class="token comment">// request will be stopped. DisallowedURLFilters will</span><span class="token comment">// be evaluated before URLFilters</span><span class="token comment">// Leave it blank to allow any URLs to be visited</span>DisallowedURLFilters <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>regexp<span class="token punctuation">.</span>Regexp<span class="token comment">// URLFilters is a list of regular expressions which restricts</span><span class="token comment">// visiting URLs. If any of the rules matches to a URL the</span><span class="token comment">// request won't be stopped. DisallowedURLFilters will</span><span class="token comment">// be evaluated before URLFilters</span><span class="token comment">// Leave it blank to allow any URLs to be visited</span>URLFilters <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>regexp<span class="token punctuation">.</span>Regexp<span class="token comment">// AllowURLRevisit allows multiple downloads of the same URL</span>AllowURLRevisit <span class="token builtin">bool</span><span class="token comment">// MaxBodySize is the limit of the retrieved response body in bytes.</span><span class="token comment">// 0 means unlimited.</span><span class="token comment">// The default value for MaxBodySize is 10MB (10 * 1024 * 1024 bytes).</span>MaxBodySize <span class="token builtin">int</span><span class="token comment">// CacheDir specifies a location where GET requests are cached as files.</span><span class="token comment">// When it's not defined, caching is disabled.</span>CacheDir <span class="token builtin">string</span><span class="token comment">// IgnoreRobotsTxt allows the Collector to ignore any restrictions set by</span><span class="token comment">// the target host's robots.txt file.  See http://www.robotstxt.org/ for more</span><span class="token comment">// information.</span>IgnoreRobotsTxt <span class="token builtin">bool</span><span class="token comment">// Async turns on asynchronous network communication. Use Collector.Wait() to</span><span class="token comment">// be sure all requests have been finished.</span>Async <span class="token builtin">bool</span><span class="token comment">// ParseHTTPErrorResponse allows parsing HTTP responses with non 2xx status codes.</span><span class="token comment">// By default, Colly parses only successful HTTP responses. Set ParseHTTPErrorResponse</span><span class="token comment">// to true to enable it.</span>ParseHTTPErrorResponse <span class="token builtin">bool</span><span class="token comment">// ID is the unique identifier of a collector</span>ID <span class="token builtin">uint32</span><span class="token comment">// DetectCharset can enable character encoding detection for non-utf8 response bodies</span><span class="token comment">// without explicit charset declaration. This feature uses https://github.com/saintfish/chardet</span>DetectCharset <span class="token builtin">bool</span><span class="token comment">// RedirectHandler allows control on how a redirect will be managed</span>RedirectHandler <span class="token keyword">func</span><span class="token punctuation">(</span>req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> via <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token builtin">error</span><span class="token comment">// CheckHead performs a HEAD request before every GET to pre-validate the response</span>CheckHead         <span class="token builtin">bool</span>store             storage<span class="token punctuation">.</span>Storagedebugger          debug<span class="token punctuation">.</span>DebuggerrobotsMap         <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>robotstxt<span class="token punctuation">.</span>RobotsDatahtmlCallbacks     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>htmlCallbackContainerxmlCallbacks      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>xmlCallbackContainerrequestCallbacks  <span class="token punctuation">[</span><span class="token punctuation">]</span>RequestCallbackresponseCallbacks <span class="token punctuation">[</span><span class="token punctuation">]</span>ResponseCallbackerrorCallbacks    <span class="token punctuation">[</span><span class="token punctuation">]</span>ErrorCallbackscrapedCallbacks  <span class="token punctuation">[</span><span class="token punctuation">]</span>ScrapedCallbackrequestCount      <span class="token builtin">uint32</span>responseCount     <span class="token builtin">uint32</span>backend           <span class="token operator">*</span>httpBackendwg                <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGrouplock              <span class="token operator">*</span>sync<span class="token punctuation">.</span>RWMutex<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„å…·ä½“å±æ€§æˆ‘å°±ä¸ä»‹ç»äº†ï¼Œ çœ‹çœ‹æ³¨é‡Šä¹Ÿå°±æ‡‚äº†ã€‚<br>æˆ‘å°±å…ˆæŒ‰ä¸Šé¢çš„ç¤ºä¾‹è§£é‡Šæºç </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">   // åˆ›å»ºä¸€ä¸ª Collectorå¯¹è±¡c :<span class="token operator">=</span> colly.NewCollector<span class="token punctuation">(</span>// Visit only domains: hackerspaces.org, wiki.hackerspaces.orgcolly.AllowedDomains<span class="token punctuation">(</span><span class="token string">"hackerspaces.org"</span>, <span class="token string">"wiki.hackerspaces.org"</span><span class="token punctuation">)</span>,<span class="token punctuation">)</span>// æ·»åŠ ä¸€ä¸ªHTMLçš„å›è°ƒå‡½æ•°c.OnHTML<span class="token punctuation">(</span><span class="token string">"a[href]"</span>, func<span class="token punctuation">(</span>e *colly.HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">link</span> :<span class="token operator">=</span> e.Attr<span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span>// Print <span class="token function">link</span>fmt.Printf<span class="token punctuation">(</span><span class="token string">"Link found: %q -&gt; %s<span class="token entity" title="\n">\n</span>"</span>, e.Text, <span class="token function">link</span><span class="token punctuation">)</span>// Visit <span class="token function">link</span> found on page// Only those links are visited <span class="token function">which</span> are <span class="token keyword">in</span> AllowedDomainsc.Visit<span class="token punctuation">(</span>e.Request.AbsoluteURL<span class="token punctuation">(</span>link<span class="token punctuation">))</span><span class="token punctuation">}</span><span class="token punctuation">)</span>// æ·»åŠ ä¸€ä¸ª Requsetå›è°ƒå‡½æ•°c.OnRequest<span class="token punctuation">(</span>func<span class="token punctuation">(</span>r *colly.Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt.Println<span class="token punctuation">(</span><span class="token string">"Visiting"</span>, r.URL.String<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">}</span><span class="token punctuation">)</span>// å¼€å§‹çˆ¬å–c.Visit<span class="token punctuation">(</span><span class="token string">"https://hackerspaces.org/"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å›è°ƒå‡½æ•°å¦‚ä½•ç”¨ï¼Ÿ ä»€ä¹ˆä½œç”¨ï¼Ÿ å…ˆå–ä¸ªå…³å­ï¼Œ <code>c.Visit("https://hackerspaces.org/")</code>æ˜¯å…¥å£ï¼Œ é‚£å°±å…ˆåˆ†æå®ƒï¼Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Visit starts Collector's collecting job by creating a</span><span class="token comment">// request to the URL specified in parameter.</span><span class="token comment">// Visit also calls the previously provided callbacks</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">Visit</span><span class="token punctuation">(</span>URL <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>CheckHead <span class="token punctuation">{</span><span class="token keyword">if</span> check <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">scrape</span><span class="token punctuation">(</span>URL<span class="token punctuation">,</span> <span class="token string">"HEAD"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> check <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> check<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">scrape</span><span class="token punctuation">(</span>URL<span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ‘†åˆå‡ºæ¥ä¸€ä¸ªæ–°çš„methodï¼Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">scrape</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method <span class="token builtin">string</span><span class="token punctuation">,</span> depth <span class="token builtin">int</span><span class="token punctuation">,</span> requestData io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> ctx <span class="token operator">*</span>Context<span class="token punctuation">,</span> hdr http<span class="token punctuation">.</span>Header<span class="token punctuation">,</span> checkRevisit <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    <span class="token comment">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦åˆæ³•</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">requestCheck</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> checkRevisit<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span>    <span class="token comment">// è§£æurlï¼Œ</span>parsedURL<span class="token punctuation">,</span> err <span class="token operator">:=</span> url<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> parsedURL<span class="token punctuation">.</span>Scheme <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>parsedURL<span class="token punctuation">.</span>Scheme <span class="token operator">=</span> <span class="token string">"http"</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token operator">!</span>c<span class="token punctuation">.</span><span class="token function">isDomainAllowed</span><span class="token punctuation">(</span>parsedURL<span class="token punctuation">.</span><span class="token function">Hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> ErrForbiddenDomain<span class="token punctuation">}</span>    <span class="token comment">// robotsåè®®</span><span class="token keyword">if</span> method <span class="token operator">!=</span> <span class="token string">"HEAD"</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>c<span class="token punctuation">.</span>IgnoreRobotsTxt <span class="token punctuation">{</span><span class="token keyword">if</span> err <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">checkRobots</span><span class="token punctuation">(</span>parsedURL<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token punctuation">}</span>     <span class="token comment">// headers</span><span class="token keyword">if</span> hdr <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>hdr <span class="token operator">=</span> http<span class="token punctuation">.</span>Header<span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>c<span class="token punctuation">.</span>UserAgent<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>rc<span class="token punctuation">,</span> ok <span class="token operator">:=</span> requestData<span class="token punctuation">.</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>ReadCloser<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> requestData <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>rc <span class="token operator">=</span> ioutil<span class="token punctuation">.</span><span class="token function">NopCloser</span><span class="token punctuation">(</span>requestData<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// The Go HTTP API ignores "Host" in the headers, preferring the client</span><span class="token comment">// to use the Host field on Request.</span>host <span class="token operator">:=</span> parsedURL<span class="token punctuation">.</span>Host<span class="token keyword">if</span> hostHeader <span class="token operator">:=</span> hdr<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> hostHeader <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>host <span class="token operator">=</span> hostHeader<span class="token punctuation">}</span>    <span class="token comment">// æ„é€ http.Request</span>req <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">{</span>Method<span class="token punctuation">:</span>     method<span class="token punctuation">,</span>URL<span class="token punctuation">:</span>        parsedURL<span class="token punctuation">,</span>Proto<span class="token punctuation">:</span>      <span class="token string">"HTTP/1.1"</span><span class="token punctuation">,</span>ProtoMajor<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>ProtoMinor<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>Header<span class="token punctuation">:</span>     hdr<span class="token punctuation">,</span>Body<span class="token punctuation">:</span>       rc<span class="token punctuation">,</span>Host<span class="token punctuation">:</span>       host<span class="token punctuation">,</span><span class="token punctuation">}</span>    <span class="token comment">// è¯·æ±‚çš„æ•°æ®ï¼ˆrequestDataï¼‰è½¬æ¢æˆio.ReadCloseræ¥å£æ•°æ®</span><span class="token function">setRequestBody</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> requestData<span class="token punctuation">)</span>u <span class="token operator">=</span> parsedURL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">// å¼‚æ­¥æ–¹å¼</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>Async <span class="token punctuation">{</span><span class="token keyword">go</span> c<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> requestData<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> hdr<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> requestData<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> hdr<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å¾ˆå¤§ç¯‡å¹…éƒ½æ˜¯æ£€æŸ¥ï¼Œ ç°åœ¨è¿˜åœ¨ <code>request</code>çš„é˜¶æ®µï¼Œ è¿˜æ²¡æœ‰responseï¼Œçœ‹<code>c.fetch</code></p><p>fetchå°±æ˜¯collyçš„æ ¸å¿ƒå†…å®¹</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">fetch</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method <span class="token builtin">string</span><span class="token punctuation">,</span> depth <span class="token builtin">int</span><span class="token punctuation">,</span> requestData io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> ctx <span class="token operator">*</span>Context<span class="token punctuation">,</span> hdr http<span class="token punctuation">.</span>Header<span class="token punctuation">,</span> req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">defer</span> c<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> ctx <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>ctx <span class="token operator">=</span> <span class="token function">NewContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>request <span class="token operator">:=</span> <span class="token operator">&amp;</span>Request<span class="token punctuation">{</span>URL<span class="token punctuation">:</span>       req<span class="token punctuation">.</span>URL<span class="token punctuation">,</span>Headers<span class="token punctuation">:</span>   <span class="token operator">&amp;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">,</span>Ctx<span class="token punctuation">:</span>       ctx<span class="token punctuation">,</span>Depth<span class="token punctuation">:</span>     depth<span class="token punctuation">,</span>Method<span class="token punctuation">:</span>    method<span class="token punctuation">,</span>Body<span class="token punctuation">:</span>      requestData<span class="token punctuation">,</span>collector<span class="token punctuation">:</span> c<span class="token punctuation">,</span> <span class="token comment">// è¿™é‡Œå°†Collectoræ”¾åˆ°requestä¸­ï¼Œè¿™ä¸ªå¯ä»¥å¯¹è¯·æ±‚ç»§ç»­å¤„ç†</span>ID<span class="token punctuation">:</span>        atomic<span class="token punctuation">.</span><span class="token function">AddUint32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">.</span>requestCount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span>    <span class="token comment">// å›è°ƒå‡½æ•°å¤„ç† request</span>c<span class="token punctuation">.</span><span class="token function">handleOnRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token keyword">if</span> request<span class="token punctuation">.</span>abort <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">"POST"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"*/*"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>origURL <span class="token operator">:=</span> req<span class="token punctuation">.</span>URL    <span class="token comment">// è¿™é‡Œæ˜¯ å»è¯·æ±‚ç½‘ç»œï¼Œ æ˜¯è°ƒç”¨äº† `http.Client.Do`æ–¹æ³•è¯·æ±‚çš„</span>response<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>backend<span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> c<span class="token punctuation">.</span>MaxBodySize<span class="token punctuation">,</span> c<span class="token punctuation">.</span>CacheDir<span class="token punctuation">)</span><span class="token keyword">if</span> proxyURL<span class="token punctuation">,</span> ok <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span>ProxyURLKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>request<span class="token punctuation">.</span>ProxyURL <span class="token operator">=</span> proxyURL<span class="token punctuation">}</span>    <span class="token comment">// å›è°ƒå‡½æ•°ï¼Œå¤„ç†error</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">handleOnError</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> err<span class="token punctuation">,</span> request<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> req<span class="token punctuation">.</span>URL <span class="token operator">!=</span> origURL <span class="token punctuation">{</span>request<span class="token punctuation">.</span>URL <span class="token operator">=</span> req<span class="token punctuation">.</span>URLrequest<span class="token punctuation">.</span>Headers <span class="token operator">=</span> <span class="token operator">&amp;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">}</span>atomic<span class="token punctuation">.</span><span class="token function">AddUint32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">.</span>responseCount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>response<span class="token punctuation">.</span>Ctx <span class="token operator">=</span> ctxresponse<span class="token punctuation">.</span>Request <span class="token operator">=</span> requesterr <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">fixCharset</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>DetectCharset<span class="token punctuation">,</span> request<span class="token punctuation">.</span>ResponseCharacterEncoding<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span>    <span class="token comment">// å›è°ƒå‡½æ•° å¤„ç†Response</span>c<span class="token punctuation">.</span><span class="token function">handleOnResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>        <span class="token comment">// å›è°ƒå‡½æ•° HTML</span>err <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">handleOnHTML</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">handleOnError</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> err<span class="token punctuation">,</span> request<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token comment">// å›è°ƒå‡½æ•°XML</span>err <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">handleOnXML</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">handleOnError</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> err<span class="token punctuation">,</span> request<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token comment">// å›è°ƒå‡½æ•° Scraped</span>c<span class="token punctuation">.</span><span class="token function">handleOnScraped</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹åˆ°äº†ï¼Œ è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµç¨‹ã€‚ å¥½ï¼Œ æˆ‘ä»¬çœ‹ä¸€ä¸‹å›è°ƒå‡½æ•°åšäº†ä»€ä¹ˆï¼Ÿ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnRequest</span><span class="token punctuation">(</span>r <span class="token operator">*</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>requestCallbacks <span class="token punctuation">{</span><span class="token function">f</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ ¸å¿ƒå°± <code>for _, f := range c.requestCallbacks { f(r) }</code>è¿™å¥ï¼Œä¸‹é¢æˆ‘æ¯ä¸ªå›è°ƒå‡½æ•°éƒ½ä»‹ç»ä¸€ä¸‹</p><h3 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h3><p>è¿™é‡Œä»‹ç»æŒ‰ç”Ÿå‘½å‘¨æœŸçš„é¡ºåºæ¥ä»‹ç»</p><h4 id="1-OnRequest"><a href="#1-OnRequest" class="headerlink" title="1. OnRequest"></a>1. OnRequest</h4> <pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnRequest registers a function. Function will be executed on every</span><span class="token comment">// request made by the Collector</span><span class="token comment">// è¿™é‡Œæ˜¯æ³¨å†Œå›è°ƒå‡½æ•°åˆ° requestCallbacks</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnRequest</span><span class="token punctuation">(</span>f RequestCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>requestCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>requestCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>RequestCallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>requestCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>requestCallbacks<span class="token punctuation">,</span> f<span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// åœ¨fetchä¸­è°ƒç”¨æœ€æ—©è°ƒç”¨çš„</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnRequest</span><span class="token punctuation">(</span>r <span class="token operator">*</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>requestCallbacks <span class="token punctuation">{</span><span class="token function">f</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-OnResponse-amp-handleOnResponse"><a href="#2-OnResponse-amp-handleOnResponse" class="headerlink" title="2. OnResponse &amp; handleOnResponse"></a>2. OnResponse &amp; handleOnResponse</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnResponse registers a function. Function will be executed on every response</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnResponse</span><span class="token punctuation">(</span>f ResponseCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>responseCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>responseCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ResponseCallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>responseCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>responseCallbacks<span class="token punctuation">,</span> f<span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnResponse</span><span class="token punctuation">(</span>r <span class="token operator">*</span>Response<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"response"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span>    r<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"status"</span><span class="token punctuation">:</span> http<span class="token punctuation">.</span><span class="token function">StatusText</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>responseCallbacks <span class="token punctuation">{</span><span class="token function">f</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-OnHTML-amp-handleOnHTML"><a href="#3-OnHTML-amp-handleOnHTML" class="headerlink" title="3. OnHTML &amp; handleOnHTML"></a>3. OnHTML &amp; handleOnHTML</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnHTML registers a function. Function will be executed on every HTML</span><span class="token comment">// element matched by the GoQuery Selector parameter.</span><span class="token comment">// GoQuery Selector is a selector used by https://github.com/PuerkitoBio/goquery</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnHTML</span><span class="token punctuation">(</span>goquerySelector <span class="token builtin">string</span><span class="token punctuation">,</span> f HTMLCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>htmlCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>htmlCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>htmlCallbackContainer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>htmlCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>htmlCallbacks<span class="token punctuation">,</span> <span class="token operator">&amp;</span>htmlCallbackContainer<span class="token punctuation">{</span>Selector<span class="token punctuation">:</span> goquerySelector<span class="token punctuation">,</span>Function<span class="token punctuation">:</span> f<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è¿™ä¸ªè§£æhtmlçš„é€»è¾‘æ¯”è¾ƒå¤šä¸€äº›</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnHTML</span><span class="token punctuation">(</span>resp <span class="token operator">*</span>Response<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>htmlCallbacks<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span>doc<span class="token punctuation">,</span> err <span class="token operator">:=</span> goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> href<span class="token punctuation">,</span> found <span class="token operator">:=</span> doc<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"base[href]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> found <span class="token punctuation">{</span>resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>baseURL<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> cc <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>htmlCallbacks <span class="token punctuation">{</span>i <span class="token operator">:=</span> <span class="token number">0</span>doc<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Selector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Each</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> s <span class="token operator">*</span>goquery<span class="token punctuation">.</span>Selection<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> s<span class="token punctuation">.</span>Nodes <span class="token punctuation">{</span>e <span class="token operator">:=</span> <span class="token function">NewHTMLElementFromSelectionNode</span><span class="token punctuation">(</span>resp<span class="token punctuation">,</span> s<span class="token punctuation">,</span> n<span class="token punctuation">,</span> i<span class="token punctuation">)</span>i<span class="token operator">++</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"selector"</span><span class="token punctuation">:</span> cc<span class="token punctuation">.</span>Selector<span class="token punctuation">,</span><span class="token string">"url"</span><span class="token punctuation">:</span>      resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>cc<span class="token punctuation">.</span><span class="token function">Function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-OnXML-amp-handleOnXML"><a href="#4-OnXML-amp-handleOnXML" class="headerlink" title="4. OnXML &amp; handleOnXML"></a>4. OnXML &amp; handleOnXML</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnXML registers a function. Function will be executed on every XML</span><span class="token comment">// element matched by the xpath Query parameter.</span><span class="token comment">// xpath Query is used by https://github.com/antchfx/xmlquery</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnXML</span><span class="token punctuation">(</span>xpathQuery <span class="token builtin">string</span><span class="token punctuation">,</span> f XMLCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>xmlCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>xmlCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>xmlCallbackContainer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>xmlCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>xmlCallbacks<span class="token punctuation">,</span> <span class="token operator">&amp;</span>xmlCallbackContainer<span class="token punctuation">{</span>Query<span class="token punctuation">:</span>    xpathQuery<span class="token punctuation">,</span>Function<span class="token punctuation">:</span> f<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnXML</span><span class="token punctuation">(</span>resp <span class="token operator">*</span>Response<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>xmlCallbacks<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span>contentType <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>isXMLFile <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">".xml"</span><span class="token punctuation">)</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">".xml.gz"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"xml"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isXMLFile<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>doc<span class="token punctuation">,</span> err <span class="token operator">:=</span> htmlquery<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> e <span class="token operator">:=</span> htmlquery<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token string">"//base"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> e<span class="token punctuation">.</span>Attr <span class="token punctuation">{</span><span class="token keyword">if</span> a<span class="token punctuation">.</span>Key <span class="token operator">==</span> <span class="token string">"href"</span> <span class="token punctuation">{</span>resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>baseURL<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> cc <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>xmlCallbacks <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> htmlquery<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> cc<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">{</span>e <span class="token operator">:=</span> <span class="token function">NewXMLElementFromHTMLNode</span><span class="token punctuation">(</span>resp<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"xml"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"selector"</span><span class="token punctuation">:</span> cc<span class="token punctuation">.</span>Query<span class="token punctuation">,</span><span class="token string">"url"</span><span class="token punctuation">:</span>      resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>cc<span class="token punctuation">.</span><span class="token function">Function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"xml"</span><span class="token punctuation">)</span> <span class="token operator">||</span> isXMLFile <span class="token punctuation">{</span>doc<span class="token punctuation">,</span> err <span class="token operator">:=</span> xmlquery<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> cc <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>xmlCallbacks <span class="token punctuation">{</span>xmlquery<span class="token punctuation">.</span><span class="token function">FindEach</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> cc<span class="token punctuation">.</span>Query<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">,</span> n <span class="token operator">*</span>xmlquery<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token punctuation">{</span>e <span class="token operator">:=</span> <span class="token function">NewXMLElementFromXMLNode</span><span class="token punctuation">(</span>resp<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"xml"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"selector"</span><span class="token punctuation">:</span> cc<span class="token punctuation">.</span>Query<span class="token punctuation">,</span><span class="token string">"url"</span><span class="token punctuation">:</span>      resp<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>cc<span class="token punctuation">.</span><span class="token function">Function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-OnError-amp-handleOnError"><a href="#5-OnError-amp-handleOnError" class="headerlink" title="5. OnError &amp; handleOnError"></a>5. OnError &amp; handleOnError</h4><p>è¿™ä¸ªä¼šå¤šæ¬¡è°ƒç”¨ï¼Œ å¦‚æœ <code>err != nilæƒ…å†µä¸‹è°ƒç”¨æ¯”è¾ƒå¤š</code>ï¼Œ çˆ¬è™«å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œä¼šè°ƒç”¨</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnError registers a function. Function will be executed if an error</span><span class="token comment">// occurs during the HTTP request.</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnError</span><span class="token punctuation">(</span>f ErrorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>errorCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>errorCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ErrorCallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>errorCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>errorCallbacks<span class="token punctuation">,</span> f<span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnError</span><span class="token punctuation">(</span>response <span class="token operator">*</span>Response<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">,</span> request <span class="token operator">*</span>Request<span class="token punctuation">,</span> ctx <span class="token operator">*</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>ParseHTTPErrorResponse <span class="token operator">||</span> response<span class="token punctuation">.</span>StatusCode <span class="token operator">&lt;</span> <span class="token number">203</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>StatusCode <span class="token operator">&gt;=</span> <span class="token number">203</span> <span class="token punctuation">{</span>err <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">StatusText</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> response <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>response <span class="token operator">=</span> <span class="token operator">&amp;</span>Response<span class="token punctuation">{</span>Request<span class="token punctuation">:</span> request<span class="token punctuation">,</span>Ctx<span class="token punctuation">:</span>     ctx<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span>    request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"status"</span><span class="token punctuation">:</span> http<span class="token punctuation">.</span><span class="token function">StatusText</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>Request <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>response<span class="token punctuation">.</span>Request <span class="token operator">=</span> request<span class="token punctuation">}</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>Ctx <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>response<span class="token punctuation">.</span>Ctx <span class="token operator">=</span> request<span class="token punctuation">.</span>Ctx<span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>errorCallbacks <span class="token punctuation">{</span><span class="token function">f</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-OnScraped-amp-handleOnScraped"><a href="#6-OnScraped-amp-handleOnScraped" class="headerlink" title="6. OnScraped &amp; handleOnScraped"></a>6. OnScraped &amp; handleOnScraped</h4><p>æœ€åä¸€æ­¥çš„å›è°ƒå‡½æ•°å¤„ç†</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// OnScraped registers a function. Function will be executed after</span><span class="token comment">// OnHTML, as a final part of the scraping.</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">OnScraped</span><span class="token punctuation">(</span>f ScrapedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>scrapedCallbacks <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>scrapedCallbacks <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ScrapedCallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>scrapedCallbacks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>scrapedCallbacks<span class="token punctuation">,</span> f<span class="token punctuation">)</span>c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">handleOnScraped</span><span class="token punctuation">(</span>r <span class="token operator">*</span>Response<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>debugger <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">"scraped"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span> r<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>scrapedCallbacks <span class="token punctuation">{</span><span class="token function">f</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨å†Œå›è°ƒå‡½æ•°çš„methodè¿˜æœ‰å‡ ä¸ªæ²¡æœ‰åˆ—å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„ï¼Œè‡ªå·±çœ‹ä¸€ä¸‹ï¼Œ</p><p>ä¸Šé¢ä»‹ç»å®Œäº†ï¼Œ å†å›å¤´çœ‹ğŸŒ°</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// On every a element which has href attribute call callback</span>c<span class="token punctuation">.</span><span class="token function">OnHTML</span><span class="token punctuation">(</span><span class="token string">"a[href]"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>colly<span class="token punctuation">.</span>HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>link <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token comment">// Print link</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Link found: %q -&gt; %s\n"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> link<span class="token punctuation">)</span><span class="token comment">// Visit link found on page</span><span class="token comment">// Only those links are visited which are in AllowedDomains</span>c<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">AbsoluteURL</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// Before making a request print "Visiting ..."</span>c<span class="token punctuation">.</span><span class="token function">OnRequest</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token operator">*</span>colly<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Visiting"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€èˆ¬æ–‡æ¡£è§£ææ”¾åœ¨html, xml ä¸­</p><h3 id="é¡µé¢è·³è½¬çˆ¬å–"><a href="#é¡µé¢è·³è½¬çˆ¬å–" class="headerlink" title="é¡µé¢è·³è½¬çˆ¬å–"></a>é¡µé¢è·³è½¬çˆ¬å–</h3><p>ä¸€èˆ¬å¤„ç†å°±2ç§ï¼Œä¸€ç§æ˜¯ç›¸åŒé€»è¾‘çš„é¡µé¢ï¼Œæ¯”å¦‚<code>ä¸‹ä¸€é¡µ</code>ï¼Œå¦ä¸€ç§ï¼Œå°±æ˜¯ä¸åŒé€»è¾‘çš„ï¼Œæ¯”å¦‚<code>å­é¡µé¢</code></p><ol><li>åœ¨<code>html</code>,<code>xml</code>ï¼Œè§£æå‡ºæ¥ä»¥åï¼Œæ„å»ºæ–°çš„è¯·æ±‚ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œç›¸åŒé¡µé¢<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// On every a element which has href attribute call callback</span>c<span class="token punctuation">.</span><span class="token function">OnHTML</span><span class="token punctuation">(</span><span class="token string">"a[href]"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>colly<span class="token punctuation">.</span>HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// If attribute class is this long string return from callback</span><span class="token comment">// As this a is irrelevant</span><span class="token keyword">if</span> e<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Button_1qxkboh-o_O-primary_cv02ee-o_O-md_28awn8-o_O-primaryLink_109aggg"</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span>link <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token comment">// If link start with browse or includes either signup or login return from callback</span><span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">"/browse"</span><span class="token punctuation">)</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">"=signup"</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">"=login"</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token comment">// start scaping the page under the link found</span>e<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>ä¸Šé¢æ˜¯ HTMLçš„å›è°ƒå‡½æ•°ï¼Œè§£æé¡µé¢ï¼Œè·å–äº†<code>url</code>,ä½¿ç”¨ <code>e.Request.Visit(link)</code>, å…¶å®å°±æ˜¯ <code>e.Request.collector.Visit(link)</code><br>æˆ‘è§£é‡Šä¸€ä¸‹<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Collector<span class="token punctuation">)</span> <span class="token function">fetch</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> method <span class="token builtin">string</span><span class="token punctuation">,</span> depth <span class="token builtin">int</span><span class="token punctuation">,</span> requestData io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> ctx <span class="token operator">*</span>Context<span class="token punctuation">,</span> hdr http<span class="token punctuation">.</span>Header<span class="token punctuation">,</span> req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">defer</span> c<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> ctx <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>ctx <span class="token operator">=</span> <span class="token function">NewContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>request <span class="token operator">:=</span> <span class="token operator">&amp;</span>Request<span class="token punctuation">{</span>URL<span class="token punctuation">:</span>       req<span class="token punctuation">.</span>URL<span class="token punctuation">,</span>Headers<span class="token punctuation">:</span>   <span class="token operator">&amp;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">,</span>Ctx<span class="token punctuation">:</span>       ctx<span class="token punctuation">,</span>Depth<span class="token punctuation">:</span>     depth<span class="token punctuation">,</span>Method<span class="token punctuation">:</span>    method<span class="token punctuation">,</span>Body<span class="token punctuation">:</span>      requestData<span class="token punctuation">,</span>collector<span class="token punctuation">:</span> c<span class="token punctuation">,</span> <span class="token comment">// è¿™ä¸ªä¸Šé¢æœ‰ä»‹ç»</span>ID<span class="token punctuation">:</span>        atomic<span class="token punctuation">.</span><span class="token function">AddUint32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">.</span>requestCount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span>    <span class="token operator">...</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Visit continues Collector's collecting job by creating a</span><span class="token comment">// request and preserves the Context of the previous request.</span><span class="token comment">// Visit also calls the previously provided callbacks</span><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Request<span class="token punctuation">)</span> <span class="token function">Visit</span><span class="token punctuation">(</span>URL <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">return</span> r<span class="token punctuation">.</span>collector<span class="token punctuation">.</span><span class="token function">scrape</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">AbsoluteURL</span><span class="token punctuation">(</span>URL<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Depth<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>è¿™ç§æ–¹æ³•åœ¨å®é™…å¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°ã€‚</li></ol><ol start="2"><li>å­é¡µé¢çš„å¤„ç†é€»è¾‘<br>collyä¸­ä¸»è¦æ˜¯ä»¥<code>Collector</code>ä¸ºä¸­å¿ƒï¼Œ ç„¶åå„ç§å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå­é¡µé¢éœ€è¦ä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥å°±éœ€è¦æ–°çš„ <code>Collector</code></li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Instantiate default collector</span>c <span class="token operator">:=</span> colly<span class="token punctuation">.</span><span class="token function">NewCollector</span><span class="token punctuation">(</span><span class="token comment">// Visit only domains: coursera.org, www.coursera.org</span>colly<span class="token punctuation">.</span><span class="token function">AllowedDomains</span><span class="token punctuation">(</span><span class="token string">"coursera.org"</span><span class="token punctuation">,</span> <span class="token string">"www.coursera.org"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// Cache responses to prevent multiple download of pages</span><span class="token comment">// even if the collector is restarted</span>colly<span class="token punctuation">.</span><span class="token function">CacheDir</span><span class="token punctuation">(</span><span class="token string">"./coursera_cache"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token comment">// Create another collector to scrape course details</span>detailCollector <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// Before making a request print "Visiting ..."</span>c<span class="token punctuation">.</span><span class="token function">OnRequest</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token operator">*</span>colly<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"visiting"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// On every a HTML element which has name attribute call callback</span>c<span class="token punctuation">.</span><span class="token function">OnHTML</span><span class="token punctuation">(</span><span class="token string">`a[name]`</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>colly<span class="token punctuation">.</span>HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// Activate detailCollector if the link contains "coursera.org/learn"</span>courseURL <span class="token operator">:=</span> e<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">AbsoluteURL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>courseURL<span class="token punctuation">,</span> <span class="token string">"coursera.org/learn"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>          <span class="token comment">// å­é¡µé¢æˆ–å…¶ä»–é¡µé¢</span>detailCollector<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span>courseURL<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p><code>Collector</code>å¯¹è±¡æœ‰ä¸€ä¸ªå±æ€§ <code>store             storage.Storage</code>æ˜¯å­˜å‚¨çš„ï¼Œè¿™ä¸ªæ˜¯å°†æ•°æ®ç›´æ¥å­˜å‚¨ä¸‹æ¥ï¼Œæ²¡æœ‰æ¸…æ´—ã€‚<br>æ¯”å¦‚ï¼Œ æˆ‘éœ€è¦å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œå…¶å®å¾ˆç®€å•ï¼Œ åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†ã€‚</p><p>ç»™ä¸ªä¾‹å­</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">c<span class="token punctuation">.</span><span class="token function">OnHTML</span><span class="token punctuation">(</span><span class="token string">"#currencies-all tbody tr"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>colly<span class="token punctuation">.</span>HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">WriteObjectStrings</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">ChildText</span><span class="token punctuation">(</span><span class="token string">".currency-name-container"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildText</span><span class="token punctuation">(</span><span class="token string">".col-symbol"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">"a.price"</span><span class="token punctuation">,</span> <span class="token string">"data-usd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">"a.volume"</span><span class="token punctuation">,</span> <span class="token string">"data-usd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">".market-cap"</span><span class="token punctuation">,</span> <span class="token string">"data-usd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">".percent-change[data-timespan=\"1h\"]"</span><span class="token punctuation">,</span> <span class="token string">"data-percentusd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">".percent-change[data-timespan=\"24h\"]"</span><span class="token punctuation">,</span> <span class="token string">"data-percentusd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">ChildAttr</span><span class="token punctuation">(</span><span class="token string">".percent-change[data-timespan=\"7d\"]"</span><span class="token punctuation">,</span> <span class="token string">"data-percentusd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¥½äº†ï¼Œä»‹ç»å®Œäº†ï¼Œæˆ‘æ²¡æœ‰ä»‹ç»å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ²¡æœ‰å†™ä»»ä½•çš„ä»£ç ï¼Œ æˆ‘åªæƒ³åˆ†äº«ç»™ä½ è¿™ç§è½¯ä»¶æ¶æ„çš„ç‰¹ç‚¹ä»¥åŠè®¾è®¡æ¨¡å¼ï¼Œ å¸Œæœ›ä½ å¯ä»¥å€Ÿé‰´åº”ç”¨åˆ°å·¥ä½œä¸­ï¼Œä¸€èˆ¬å†™æ¡†æ¶éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ€ç»´ã€‚<br>ä¸‹é¢è¿™å¼ å›¾å¾ˆå½¢è±¡ï¼Œçˆ¬è™«æ¡†æ¶å°±è¿™äº›ä¸œè¥¿ã€‚<br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/BqC7ix.jpg" alt="é€šç”¨çˆ¬è™«æ¡†æ¶æ¶æ„"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crawler </tag>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> go </tag>
            
            <tag> colly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sparkåŠ è½½æ•°æ®åˆ°ES</title>
      <link href="/2021/08/01/spark-load-to-es/"/>
      <url>/2021/08/01/spark-load-to-es/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸€å®šä¼šé‡åˆ°ï¼Œsparkå°†è®¡ç®—å¥½çš„æ•°æ®loadåˆ°esä¸­ï¼Œä¾›åç«¯åŒå­¦æŸ¥è¯¢ä½¿ç”¨ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹sparkå†™esçš„æ–¹å¼ã€‚ ä½¿ç”¨scalaè¿›è¡Œæ¼”ç¤ºï¼Œå¯¹åº”çš„javaè‡ªå·±googleäº†ã€‚</p><p>sparkå†™eséœ€è¦ä½¿ç”¨åˆ° å¯¹åº”çš„åŒ…esåŒ…ã€‚mavené…ç½®å¦‚ä¸‹</p><h2 id="MAVENé…ç½®"><a href="#MAVENé…ç½®" class="headerlink" title="MAVENé…ç½®"></a>MAVENé…ç½®</h2><pre class="line-numbers language-maven" data-language="maven"><code class="language-maven">&lt;dependency&gt;    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;    &lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;    &lt;version&gt;3.0.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;    &lt;artifactId&gt;elasticsearch-hadoop&lt;/artifactId&gt;    &lt;version&gt;7.0.0&lt;/version&gt;&lt;/dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨MAPæ–¹å¼"><a href="#ä½¿ç”¨MAPæ–¹å¼" class="headerlink" title="ä½¿ç”¨MAPæ–¹å¼"></a>ä½¿ç”¨MAPæ–¹å¼</h3><p>ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">package org<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>es<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>{SparkConf<span class="token punctuation">,</span> SparkContext}<span class="token keyword">import</span> org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>_object D01 {  def main<span class="token punctuation">(</span>args: Array<span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">)</span>: Unit <span class="token operator">=</span> {    val conf: SparkConf <span class="token operator">=</span> new SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"d01"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>    conf<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"es.index.auto.create"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>    val sc: SparkContext <span class="token operator">=</span> new SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>    <span class="token comment">// mapæ–¹å¼</span>    val numbers <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"one"</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"two"</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"three"</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>    val airports <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"arrival"</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">"Otopeni"</span><span class="token punctuation">,</span> <span class="token string">"SFO"</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">"San Fran"</span><span class="token punctuation">)</span>    sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> airports<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveToEs<span class="token punctuation">(</span><span class="token string">"spark/docs"</span><span class="token punctuation">)</span>  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼š å¿…é¡»è¦å¯¼å…¥ <strong>import org.elasticsearch.spark._</strong>, ä¸ç„¶ï¼Œå°±æ²¡æœ‰ <code>saveToEs</code>æ–¹æ³•äº†</p><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹ï¼Œ org.elasticsearch.spark._ å¯¼å…¥çš„éšå¼å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/uJdnvn.jpg" alt="åŒ…å¯¹è±¡ä¸­éšå¼å‡½æ•°"></p><p>åœ¨ org.elasticsearch.spark._  ä¸‹é¢çš„åŒ…å¯¹è±¡ä¸­æœ‰ ä¸€ä¸ªéšå¼å‡½æ•°ï¼Œå°† RDDè½¬æˆ SparkRDDFunctions</p><h3 id="åç¼–è¯‘æˆ-javaä»£ç "><a href="#åç¼–è¯‘æˆ-javaä»£ç " class="headerlink" title="åç¼–è¯‘æˆ javaä»£ç "></a>åç¼–è¯‘æˆ javaä»£ç </h3> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>es</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token class-name">SparkConf</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token class-name">SparkContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span><span class="token class-name">Seq</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">BoxesRunTime</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> D01$ <span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> D01$ MODULE$<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">SparkConf</span> conf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SparkConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppName</span><span class="token punctuation">(</span><span class="token string">"d01"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMaster</span><span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"es.index.auto.create"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SparkContext</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkContext</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token class-name">ArrowAssoc</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span>$minus$greater$<span class="token function">extension</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">ArrowAssoc</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BoxesRunTime</span><span class="token punctuation">.</span><span class="token function">boxToInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token class-name">ArrowAssoc</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span>$minus$greater$<span class="token function">extension</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">ArrowAssoc</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BoxesRunTime</span><span class="token punctuation">.</span><span class="token function">boxToInteger</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token class-name">ArrowAssoc</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span>$minus$greater$<span class="token function">extension</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">ArrowAssoc</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BoxesRunTime</span><span class="token punctuation">.</span><span class="token function">boxToInteger</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Seq</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">wrapRefArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token class-name">ArrowAssoc</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span>$minus$greater$<span class="token function">extension</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">ArrowAssoc</span><span class="token punctuation">(</span><span class="token string">"arrival"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Otopeni"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token class-name">ArrowAssoc</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span>$minus$greater$<span class="token function">extension</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">ArrowAssoc</span><span class="token punctuation">(</span><span class="token string">"SFO"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"San Fran"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span> airports <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Seq</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">wrapRefArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Tuple2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> numbers<span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> airports<span class="token punctuation">;</span>    org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>spark<span class="token punctuation">.</span><span class="token keyword">package</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">sparkRDDFunctions</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">makeRDD</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Seq</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span>Seq</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Seq</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>Predef</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">wrapRefArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span>makeRDD$<span class="token keyword">default</span>$<span class="token function">2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassTag</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassTag</span>$<span class="token punctuation">.</span>MODULE$<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveToEs</span><span class="token punctuation">(</span><span class="token string">"spark/docs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token keyword">private</span> D01$<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    MODULE$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†ç»™ä¸€ä¸‹ï¼Œå…¶ä»–çš„ å†™esçš„ä»£ç </p><h2 id="å…¶ä»–æ–¹å¼å†™ES"><a href="#å…¶ä»–æ–¹å¼å†™ES" class="headerlink" title="å…¶ä»–æ–¹å¼å†™ES"></a>å…¶ä»–æ–¹å¼å†™ES</h2><h3 id="ä½¿ç”¨æ ·ä¾‹ç±»æ–¹å¼"><a href="#ä½¿ç”¨æ ·ä¾‹ç±»æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹ç±»æ–¹å¼"></a>ä½¿ç”¨æ ·ä¾‹ç±»æ–¹å¼</h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>es</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span></span>RDD<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span></span>EsSpark<span class="token keyword">object</span> D02 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> conf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"d01"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>    conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"es.index.auto.create"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>    <span class="token keyword">val</span> upcomingTrip<span class="token operator">:</span> Trip <span class="token operator">=</span> Trip<span class="token punctuation">(</span><span class="token string">"OTP"</span><span class="token punctuation">,</span> <span class="token string">"SFO"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> lastWeekTrip<span class="token operator">:</span> Trip <span class="token operator">=</span> Trip<span class="token punctuation">(</span><span class="token string">"MUC"</span><span class="token punctuation">,</span> <span class="token string">"OTP"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> rdd<span class="token operator">:</span> RDD<span class="token punctuation">[</span>Trip<span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>upcomingTrip<span class="token punctuation">,</span> lastWeekTrip<span class="token punctuation">)</span><span class="token punctuation">)</span>    EsSpark<span class="token punctuation">.</span>saveToEs<span class="token punctuation">(</span>rdd<span class="token punctuation">,</span> <span class="token string">"spark/docs"</span><span class="token punctuation">,</span> Map<span class="token punctuation">(</span><span class="token string">"es.mapping.id"</span> <span class="token operator">-&gt;</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// define a case class</span><span class="token keyword">case</span> <span class="token keyword">class</span> Trip<span class="token punctuation">(</span>departure<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> arrival<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨å­—ç¬¦ä¸²jsonæ–¹å¼"><a href="#ä½¿ç”¨å­—ç¬¦ä¸²jsonæ–¹å¼" class="headerlink" title="ä½¿ç”¨å­—ç¬¦ä¸²jsonæ–¹å¼"></a>ä½¿ç”¨å­—ç¬¦ä¸²jsonæ–¹å¼</h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>es</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>_<span class="token keyword">object</span> D03 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> conf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"d01"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>    conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"es.index.auto.create"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>    <span class="token keyword">val</span> json1 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""{"reason" : "business", "airport" : "SFO"}"""</span>    <span class="token keyword">val</span> json2 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""{"participants" : 5, "airport" : "OTP"}"""</span>    sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>json1<span class="token punctuation">,</span> json2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveToEs<span class="token punctuation">(</span><span class="token string">"spark/json-trips"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ¨æ€index"><a href="#åŠ¨æ€index" class="headerlink" title="åŠ¨æ€index"></a>åŠ¨æ€index</h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>es</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>_<span class="token keyword">object</span> D04 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> conf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">"d01"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>    conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"es.index.auto.create"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>    <span class="token keyword">val</span> game <span class="token operator">=</span> Map<span class="token punctuation">(</span>      <span class="token string">"media_type"</span> <span class="token operator">-&gt;</span> <span class="token string">"game"</span><span class="token punctuation">,</span>      <span class="token string">"title"</span> <span class="token operator">-&gt;</span> <span class="token string">"FF VI"</span><span class="token punctuation">,</span>      <span class="token string">"year"</span> <span class="token operator">-&gt;</span> <span class="token string">"1994"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> book <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"media_type"</span> <span class="token operator">-&gt;</span> <span class="token string">"book"</span><span class="token punctuation">,</span> <span class="token string">"title"</span> <span class="token operator">-&gt;</span> <span class="token string">"Harry Potter"</span><span class="token punctuation">,</span> <span class="token string">"year"</span> <span class="token operator">-&gt;</span> <span class="token string">"2010"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> cd <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"media_type"</span> <span class="token operator">-&gt;</span> <span class="token string">"music"</span><span class="token punctuation">,</span> <span class="token string">"title"</span> <span class="token operator">-&gt;</span> <span class="token string">"Surfing With The Alien"</span><span class="token punctuation">)</span>    sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>game<span class="token punctuation">,</span> book<span class="token punctuation">,</span> cd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveToEs<span class="token punctuation">(</span><span class="token string">"my-collection-{media_type}/doc"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spark </tag>
            
            <tag> es </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çˆ¬è™«çš„&quot;ç›—äº¦æœ‰é“&quot;-Robotsåè®®</title>
      <link href="/2021/07/31/robots-protocol/"/>
      <url>/2021/07/31/robots-protocol/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç»œçˆ¬è™«çš„å›å­åè®®"><a href="#ç½‘ç»œçˆ¬è™«çš„å›å­åè®®" class="headerlink" title="ç½‘ç»œçˆ¬è™«çš„å›å­åè®®"></a>ç½‘ç»œçˆ¬è™«çš„å›å­åè®®</h2><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/3tqLVS.jpg"></p><h3 id="ç½‘ç»œçˆ¬è™«çš„å°ºå¯¸"><a href="#ç½‘ç»œçˆ¬è™«çš„å°ºå¯¸" class="headerlink" title="ç½‘ç»œçˆ¬è™«çš„å°ºå¯¸"></a>ç½‘ç»œçˆ¬è™«çš„å°ºå¯¸</h3><table><thead><tr><th>å°è§„æ¨¡ï¼Œæ•°é‡å°ï¼Œçˆ¬å»é€Ÿåº¦ä¸æ•æ„Ÿï¼Œrequestsåº“</th><th>ä¸­è§„æ¨¡ï¼Œæ•°æ®è§„æ¨¡è¾ƒå¤§ï¼Œçˆ¬å–é€Ÿåº¦æ•æ„Ÿscrapyåº“</th><th>å¤§è§„æ¨¡ï¼Œæœç´¢å¼•æ“,çˆ¬å–é€Ÿåº¦å…³é”®å®šåˆ¶å¼€å‘</th></tr></thead><tbody><tr><td>çˆ¬å–ç½‘é¡µ ç©è½¬ç½‘é¡µ</td><td>çˆ¬å–ç½‘ç«™ çˆ¬å–ç³»åˆ—ç½‘ç«™</td><td>çˆ¬å–å…¨ç½‘</td></tr></tbody></table><h3 id="ç½‘ç»œçˆ¬è™«å¼•å‘çš„é—®é¢˜"><a href="#ç½‘ç»œçˆ¬è™«å¼•å‘çš„é—®é¢˜" class="headerlink" title="ç½‘ç»œçˆ¬è™«å¼•å‘çš„é—®é¢˜"></a>ç½‘ç»œçˆ¬è™«å¼•å‘çš„é—®é¢˜</h3><ul><li>æ€§èƒ½éªšæ‰°</li><li>æ³•å¾‹é£é™©</li><li>éšç§æ³„éœ²</li></ul><p><em>ç½‘ç»œçˆ¬è™«çš„â€æ€§èƒ½éªšæ‰°â€</em><br>webæœåŠ¡å™¨é»˜è®¤æ¥å—äººç±»è®¿é—®ï¼Œå—é™äºç¼–å†™æ°´å¹³å’Œç›®çš„ï¼Œç½‘ç»œçˆ¬è™«å°†ä¼šä¸ºwebæœåŠ¡å™¨å¸¦æ¥å·¨å¤§çš„èµ„æºçš„å¼€é”€ã€‚<br><em>ç½‘ç»œçˆ¬è™«çš„æ³•å¾‹é£é™©</em><br>æœåŠ¡å™¨ä¸Šçš„æ•°æ®æœ‰äº§æƒå½’å±ï¼Œç½‘ç»œçˆ¬è™«è·å–æ•°æ®åç‰Ÿåˆ©å°†ä¼šå¸¦æ¥æ³•å¾‹çš„é£é™©ã€‚<br><em>ç½‘ç»œçˆ¬è™«çš„éšç§æ³„éœ²</em><br>ç½‘ç»œçˆ¬è™«å¯èƒ½å…·å¤‡çªç ´ç®€å•è®¿é—®çš„æ§åˆ¶èƒ½åŠ›ï¼Œè·å–è¢«ä¿æŠ¤çš„æ•°æ®ï¼Œä»è€Œæ³„éœ²ä¸ªäººéšç§ã€‚</p><h3 id="ç½‘ç»œçˆ¬è™«çš„é™åˆ¶"><a href="#ç½‘ç»œçˆ¬è™«çš„é™åˆ¶" class="headerlink" title="ç½‘ç»œçˆ¬è™«çš„é™åˆ¶"></a>ç½‘ç»œçˆ¬è™«çš„é™åˆ¶</h3><ul><li>æ¥æºå®¡æŸ¥ï¼šåˆ¤æ–­<code>User-Agent</code>è¿›è¡Œé™åˆ¶ï¼Œæ£€æŸ¥æ¥è®¿è€…HTTPåè®®å¤´çš„User-AgentåŸŸï¼Œåªå“åº”æµè§ˆå™¨æˆ–å‹å¥½çˆ¬è™«çš„è®¿é—®</li><li>å‘å¸ƒå…¬å‘Šï¼š <code>Robots</code>åè®®ï¼Œ å‘ŠçŸ¥æ‰€æœ‰çš„çˆ¬è™«ç½‘ç«™çš„çˆ¬è™«ç­–ç•¥ï¼Œè¦æ±‚çˆ¬è™«éµå®ˆã€‚</li></ul><h2 id="Robotsåè®®"><a href="#Robotsåè®®" class="headerlink" title="Robotsåè®®"></a>Robotsåè®®</h2><blockquote><p>Robotsåè®®ï¼ˆä¹Ÿç§°ä¸ºçˆ¬è™«åè®®ã€æœºå™¨äººåè®®ç­‰ï¼‰çš„å…¨ç§°æ˜¯â€œç½‘ç»œçˆ¬è™«æ’é™¤æ ‡å‡†â€ï¼ˆRobots ExclusionProtocolï¼‰ï¼Œç½‘ç«™é€šè¿‡Robotsåè®®å‘Šè¯‰æœç´¢å¼•æ“å“ªäº›é¡µé¢å¯ä»¥æŠ“å–ï¼Œå“ªäº›é¡µé¢ä¸èƒ½æŠ“å–.</p></blockquote><p>æ ¹æ®åè®®ï¼Œç½‘ç«™ç®¡ç†å‘˜å¯ä»¥åœ¨ç½‘ç«™åŸŸåçš„æ ¹ç›®å½•ä¸‹æ”¾ä¸€ä¸ªrobots.txt æ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥æŒ‡å®šä¸åŒçš„ç½‘ç»œçˆ¬è™«èƒ½è®¿é—®çš„é¡µé¢å’Œç¦æ­¢è®¿é—®çš„é¡µé¢ï¼ŒæŒ‡å®šçš„é¡µé¢ç”±æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºã€‚ç½‘ç»œçˆ¬è™«åœ¨é‡‡é›†è¿™ä¸ªç½‘ç«™ä¹‹å‰ï¼Œé¦–å…ˆè·å–åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åè§£æåˆ°å…¶ä¸­çš„è§„åˆ™ï¼Œç„¶åæ ¹æ®è§„åˆ™æ¥é‡‡é›†ç½‘ç«™çš„æ•°æ®ã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸ªåè®®çš„å­˜åœ¨æ›´å¤šçš„æ˜¯éœ€è¦ç½‘ç»œçˆ¬è™«å»éµå®ˆï¼Œè€Œèµ·ä¸åˆ°é˜²æ­¢çˆ¬è™«çš„åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦Robotsåè®®"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Robotsåè®®" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Robotsåè®®"></a>ä¸ºä»€ä¹ˆéœ€è¦Robotsåè®®</h3><p>äº’è”ç½‘ä¸Šçš„ç½‘é¡µæ˜¯é€šè¿‡è¶…çº§é“¾æ¥äº’ç›¸å…³è”èµ·æ¥çš„ï¼Œä»è€Œå½¢æˆäº†ç½‘é¡µçš„ç½‘çŠ¶ç»“æ„ã€‚çˆ¬è™«çš„å·¥ä½œæ–¹å¼å°±åƒèœ˜è››åœ¨ç½‘ä¸Šæ²¿ç€é“¾æ¥çˆ¬æ¥çˆ¬å»ï¼Œæœ€åŸºæœ¬çš„æµç¨‹å¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š</p><ol><li>å–‚ç»™çˆ¬è™«ä¸€å †urlï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç§å­(seeds)ï¼›</li><li>çˆ¬è™«æŠ“å–seedsï¼Œè§£æhtmlç½‘é¡µï¼ŒæŠ½å–å…¶ä¸­çš„è¶…çº§é“¾æ¥ï¼›</li><li>çˆ¬è™«æ¥ç€æŠ“å–è¿™äº›æ–°å‘ç°çš„é“¾æ¥æŒ‡å‘çš„ç½‘é¡µã€‚</li></ol><p>æ­¥éª¤2å’Œæ­¥éª¤3å¾ªç¯å¾€å¤ã€‚</p><p>äº†è§£äº†ä¸Šé¢çš„æµç¨‹å°±èƒ½å‘ç°ï¼šå¯¹çˆ¬è™«æ¥è¯´ç½‘ç«™éå¸¸è¢«åŠ¨ï¼Œåªæœ‰è€è€å®å®è¢«æŠ“å–çš„ä»½ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºç½‘ç«™çš„ç®¡ç†è€…æ¥è¯´ï¼Œå°±å­˜åœ¨è¿™æ ·çš„éœ€æ±‚ï¼š</p><p>æŸäº›è·¯å¾„ä¸‹æ˜¯ä¸ªäººéšç§æˆ–è€…ç½‘ç«™ç®¡ç†ä½¿ç”¨ï¼Œä¸æƒ³è¢«æœç´¢å¼•æ“æŠ“å–ï¼Œæ¯”å¦‚è¯´æ—¥æœ¬çˆ±æƒ…åŠ¨ä½œç‰‡ï¼›<br>ä¸å–œæ¬¢æŸä¸ªæœç´¢å¼•æ“ï¼Œä¸æ„¿æ„è¢«ä»–æŠ“å–ï¼Œæœ€æœ‰åçš„å°±æ˜¯ä¹‹å‰æ·˜å®ä¸å¸Œæœ›è¢«ç™¾åº¦æŠ“å–ï¼›<br>å°ç½‘ç«™ä½¿ç”¨çš„æ˜¯å…¬ç”¨çš„è™šæ‹Ÿä¸»æœºï¼Œæµé‡æœ‰é™æˆ–è€…éœ€è¦ä»˜è´¹ï¼Œå¸Œæœ›æœç´¢å¼•æ“æŠ“çš„æ¸©æŸ”ç‚¹ï¼›<br>æŸäº›ç½‘é¡µæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ²¡æœ‰ç›´æ¥çš„é“¾æ¥æŒ‡å‘ï¼Œä½†æ˜¯å¸Œæœ›å†…å®¹è¢«æœç´¢å¼•æ“æŠ“å–å’Œç´¢å¼•ã€‚</p><p>ç½‘ç«™å†…å®¹çš„æ‰€æœ‰è€…æ˜¯ç½‘ç«™ç®¡ç†å‘˜ï¼Œæœç´¢å¼•æ“åº”è¯¥å°Šé‡æ‰€æœ‰è€…çš„æ„æ„¿ï¼Œä¸ºäº†æ»¡è¶³ä»¥ä¸Šç­‰ç­‰ï¼Œå°±éœ€è¦æä¾›ä¸€ç§ç½‘ç«™å’Œçˆ¬è™«è¿›è¡Œæ²Ÿé€šçš„é€”å¾„ï¼Œç»™ç½‘ç«™ç®¡ç†å‘˜è¡¨è¾¾è‡ªå·±æ„æ„¿çš„æœºä¼šã€‚æœ‰éœ€æ±‚å°±æœ‰ä¾›åº”ï¼Œrobotsåè®®å°±æ­¤è¯ç”Ÿã€‚</p><h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><p>äº¬ä¸œçš„Robotsåè®®<br><code>https://www.jd.com/robots.txt</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">User<span class="token operator">-</span>agent<span class="token operator">:</span> <span class="token operator">*</span> Disallow<span class="token operator">:</span> <span class="token operator">/</span><span class="token operator">?</span><span class="token operator">*</span> Disallow<span class="token operator">:</span> <span class="token operator">/</span>pop<span class="token comment">/*.html Disallow: /pinpai/*.html?* User-agent: EtaoSpider Disallow: / User-agent: HuihuiSpider Disallow: / User-agent: GwdangSpider Disallow: / User-agent: WochachaSpider Disallow: /</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™¾åº¦çš„Robotsåè®®<br><code>https://www.baidu.com/robots.txt</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: BaiduspiderDisallow: /baiduDisallow: /s?Disallow: /ulink?Disallow: /link?User-agent: GooglebotDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: MSNBotDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Baiduspider-imageDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: YoudaoBotDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou web spiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou inst spiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou spider2Disallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou blogDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou News SpiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: Sogou Orion spiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: ChinasoSpiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: SosospiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: yisouspiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: EasouSpiderDisallow: /baiduDisallow: /s?Disallow: /shifen/Disallow: /homepage/Disallow: /cproDisallow: /ulink?Disallow: /link?User-agent: *Disallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ï¼Œ<code>*</code>ä»£è¡¨æ‰€æœ‰ï¼Œ<code>/</code>ä»£è¡¨æ ¹ç›®å½•</p><h3 id="Robotsåè®®çš„å†™æ³•"><a href="#Robotsåè®®çš„å†™æ³•" class="headerlink" title="Robotsåè®®çš„å†™æ³•"></a>Robotsåè®®çš„å†™æ³•</h3><p>æ—¢ç„¶ç½‘ç»œçˆ¬è™«åœ¨çˆ¬å–ä¸€ä¸ªç½‘ç«™ä¹‹å‰ï¼Œè¦å…ˆè·å–åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åè§£æåˆ°å…¶ä¸­çš„è§„åˆ™ï¼Œé‚£ä¹ˆï¼ŒRobotså°±å¿…é¡»è¦æœ‰ä¸€å¥—é€šç”¨çš„è¯­æ³•è§„åˆ™ã€‚</p><p>æœ€ç®€å•çš„robots.txtåªæœ‰ä¸¤æ¡è§„åˆ™ï¼š</p><p>User-agentï¼šæŒ‡å®šå¯¹å“ªäº›çˆ¬è™«ç”Ÿæ•ˆ<br>Disallowï¼šæŒ‡å®šè¦å±è”½çš„ç½‘å€<br>å…ˆè¯´User-agentï¼Œçˆ¬è™«æŠ“å–æ—¶ä¼šå£°æ˜è‡ªå·±çš„èº«ä»½ï¼Œè¿™å°±æ˜¯User-agentï¼Œæ²¡é”™ï¼Œå°±æ˜¯httpåè®®é‡Œçš„User-agentã€‚robots.txtåˆ©ç”¨User-agentæ¥åŒºåˆ†å„ä¸ªå¼•æ“çš„çˆ¬è™«ï¼Œæ¯”å¦‚è¯´googleç½‘é¡µæœç´¢çˆ¬è™«çš„User-agentä¸ºGooglebotã€‚</p><p>å¯èƒ½æœ‰è¯»è€…è¦é—®äº†ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“çˆ¬è™«çš„User-agentæ˜¯ä»€ä¹ˆ?ä½ è¿˜å¯ä»¥æŸ¥ç›¸å…³æœç´¢å¼•æ“çš„èµ„æ–™å¾—åˆ°å®˜æ–¹çš„æ•°æ®ï¼Œæ¯”å¦‚è¯´ç™¾åº¦çš„çˆ¬è™«åˆ—è¡¨æ˜¯è¿™æ ·çš„ï¼š</p><table><thead><tr><th>äº§å“åç§°</th><th>å¯¹åº”User-Agent</th></tr></thead><tbody><tr><td>ç½‘é¡µæœç´¢</td><td>Baiduspider</td></tr><tr><td>ç§»åŠ¨æœç´¢</td><td>Baiduspider</td></tr><tr><td>å›¾ç‰‡æœç´¢</td><td>Baiduspider-image</td></tr><tr><td>è§†é¢‘æœç´¢</td><td>Baiduspider-video</td></tr><tr><td>æ–°é—»æœç´¢</td><td>Baiduspider-news</td></tr><tr><td>ç™¾åº¦æœç´¢</td><td>Baiduspider-favo</td></tr><tr><td>ç™¾åº¦è”ç›Ÿ</td><td>Baiduspider-cpro</td></tr><tr><td>å•†åŠ¡æœç´¢</td><td>Baiduspider-ads</td></tr></tbody></table><p>Disallow è¡Œåˆ—å‡ºçš„æ˜¯è¦æ‹¦æˆªçš„ç½‘é¡µï¼Œä»¥æ­£æ–œçº¿ (/) å¼€å¤´ï¼Œå¯ä»¥åˆ—å‡ºç‰¹å®šçš„ç½‘å€æˆ–æ¨¡å¼ã€‚è¦å±è”½æ•´ä¸ªç½‘ç«™ï¼Œä½¿ç”¨æ­£æ–œçº¿å³å¯;è¦å±è”½æŸä¸€ç›®å½•ä»¥åŠå…¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œåœ¨ç›®å½•ååæ·»åŠ æ­£æ–œçº¿;è¦å±è”½æŸä¸ªå…·ä½“çš„ç½‘é¡µï¼Œå°±æŒ‡å‡ºè¿™ä¸ªç½‘é¡µã€‚</p><p>ä¸‹é¢ä»‹ç»ä¸€äº›å®ä¾‹:<br>å…è®¸æ‰€æœ‰çš„robotè®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: *Disallow:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æˆ–è€…ä¹Ÿå¯ä»¥å»ºä¸€ä¸ªç©ºæ–‡ä»¶ â€œ/robots.txtâ€ fileã€‚</p><p>ç¦æ­¢çˆ¬è™«è®¿é—®æ‰€æœ‰ç›®å½•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: *Disallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç¦æ­¢çˆ¬è™«è®¿é—®æŸäº›ç›®å½•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: *Disallow: /a/Disallow: /b/Disallow: /c/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¦æ­¢æŸäº›çˆ¬è™«è®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: BadBotDisallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åªå…è®¸æŸä¸ªçˆ¬è™«è®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: MangCrawlerDisallow:User-agent: *Disallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å†æ¥ç»“åˆä¸¤ä¸ªçœŸå®çš„èŒƒä¾‹æ¥å­¦ä¹ ä¸€ä¸‹ã€‚å…ˆçœ‹è¿™ä¸ªä¾‹å­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: BaiduspiderDisallow: /User-agent: baiduspiderDisallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ˜¯æ·˜å®ç½‘çš„Robotsåè®®å†…å®¹ï¼Œç›¸ä¿¡ä½ å·²ç»çœ‹å‡ºæ¥äº†ï¼Œæ·˜å®ç½‘ç¦æ­¢ç™¾åº¦çš„çˆ¬è™«è®¿é—®ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User-agent: *Disallow: /?*Disallow: /pop/*.htmlUser-agent: EtaoSpiderDisallow: /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªç¨å¾®å¤æ‚ç‚¹ï¼Œäº¬ä¸œæœ‰2ä¸ªç›®å½•ä¸å¸Œæœ›æ‰€æœ‰çš„çˆ¬è™«æ¥æŠ“ã€‚åŒæ—¶ï¼Œäº¬ä¸œå®Œå…¨å±è”½äº†ä¸€æ·˜ç½‘çš„èœ˜è››ï¼ˆEtaoSpideræ˜¯ä¸€æ·˜ç½‘çš„èœ˜è››ï¼‰ã€‚</p><h2 id="Robotsåè®®è¿›é˜¶çŸ¥è¯†"><a href="#Robotsåè®®è¿›é˜¶çŸ¥è¯†" class="headerlink" title="Robotsåè®®è¿›é˜¶çŸ¥è¯†"></a>Robotsåè®®è¿›é˜¶çŸ¥è¯†</h2><p><strong>sitemap</strong><br>çˆ¬è™«ä¼šé€šè¿‡ç½‘é¡µå†…éƒ¨çš„é“¾æ¥å‘ç°æ–°çš„ç½‘é¡µã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰è¿æ¥æŒ‡å‘çš„ç½‘é¡µæ€ä¹ˆåŠ?æˆ–è€…ç”¨æˆ·è¾“å…¥æ¡ä»¶ç”Ÿæˆçš„åŠ¨æ€ç½‘é¡µæ€ä¹ˆåŠ?èƒ½å¦è®©ç½‘ç«™ç®¡ç†å‘˜é€šçŸ¥æœç´¢å¼•æ“ä»–ä»¬ç½‘ç«™ä¸Šæœ‰å“ªäº›å¯ä¾›æŠ“å–çš„ç½‘é¡µ?è¿™å°±æ˜¯sitemapï¼Œæœ€ç®€å•çš„ Sitepmap å½¢å¼å°±æ˜¯ XML æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åˆ—å‡ºç½‘ç«™ä¸­çš„ç½‘å€ä»¥åŠå…³äºæ¯ä¸ªç½‘å€çš„å…¶ä»–æ•°æ®(ä¸Šæ¬¡æ›´æ–°çš„æ—¶é—´ã€æ›´æ”¹çš„é¢‘ç‡ä»¥åŠç›¸å¯¹äºç½‘ç«™ä¸Šå…¶ä»–ç½‘å€çš„é‡è¦ç¨‹åº¦ç­‰ç­‰)ï¼Œåˆ©ç”¨è¿™äº›ä¿¡æ¯æœç´¢å¼•æ“å¯ä»¥æ›´åŠ æ™ºèƒ½åœ°æŠ“å–ç½‘ç«™å†…å®¹ã€‚</p><p>æ–°çš„é—®é¢˜æ¥äº†ï¼Œçˆ¬è™«æ€ä¹ˆçŸ¥é“è¿™ä¸ªç½‘ç«™æœ‰æ²¡æœ‰æä¾›sitemapæ–‡ä»¶ï¼Œæˆ–è€…è¯´ç½‘ç«™ç®¡ç†å‘˜ç”Ÿæˆäº†sitemapï¼Œ(å¯èƒ½æ˜¯å¤šä¸ªæ–‡ä»¶)ï¼Œçˆ¬è™«æ€ä¹ˆçŸ¥é“æ”¾åœ¨å“ªé‡Œå‘¢?</p><p>ç”±äºrobots.txtçš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œäºæ˜¯å¤§å®¶å°±æƒ³åˆ°äº†æŠŠsitemapçš„ä½ç½®ä¿¡æ¯æ”¾åœ¨robots.txté‡Œã€‚è¿™å°±æˆä¸ºrobots.txté‡Œçš„æ–°æˆå‘˜äº†ã€‚</p><p>èŠ‚é€‰ä¸€æ®µgoogle robots.txtï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Sitemap: http://www.gstatic.com/cultur<span class="token punctuation">..</span>.Sitemap: http://www.google.com/hostedn<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ’ä¸€å¥ï¼Œè€ƒè™‘åˆ°ä¸€ä¸ªç½‘ç«™çš„ç½‘é¡µä¼—å¤šï¼Œsitemapäººå·¥ç»´æŠ¤ä¸å¤ªé è°±ï¼Œgoogleæä¾›äº†å·¥å…·å¯ä»¥è‡ªåŠ¨ç”Ÿæˆsitemapã€‚</p><p><strong>meta tag</strong><br>å…¶å®ä¸¥æ ¼æ¥è¯´è¿™éƒ¨åˆ†å†…å®¹ä¸å±äºrobots.txtã€‚</p><p>robots.txtçš„åˆè¡·æ˜¯ä¸ºäº†è®©ç½‘ç«™ç®¡ç†å‘˜ç®¡ç†å¯ä»¥å‡ºç°åœ¨æœç´¢å¼•æ“é‡Œçš„ç½‘ç«™å†…å®¹ã€‚ä½†æ˜¯ï¼Œå³ä½¿ä½¿ç”¨ robots.txt æ–‡ä»¶è®©çˆ¬è™«æ— æ³•æŠ“å–è¿™äº›å†…å®¹ï¼Œæœç´¢å¼•æ“ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ‰¾åˆ°è¿™äº›ç½‘é¡µå¹¶å°†å®ƒæ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚ä¾‹å¦‚ï¼Œå…¶ä»–ç½‘ç«™ä»å¯èƒ½é“¾æ¥åˆ°è¯¥ç½‘ç«™ã€‚å› æ­¤ï¼Œç½‘é¡µç½‘å€åŠå…¶ä»–å…¬å¼€çš„ä¿¡æ¯(å¦‚æŒ‡å‘ç›¸å…³ç½‘ç«™çš„é“¾æ¥ä¸­çš„å®šä½æ–‡å­—æˆ–å¼€æ”¾å¼ç›®å½•ç®¡ç†ç³»ç»Ÿä¸­çš„æ ‡é¢˜)æœ‰å¯èƒ½ä¼šå‡ºç°åœ¨å¼•æ“çš„æœç´¢ç»“æœä¸­ã€‚å¦‚æœæƒ³å½»åº•å¯¹æœç´¢å¼•æ“éšèº«é‚£å’‹æ•´å‘¢?ç­”æ¡ˆæ˜¯ï¼šå…ƒæ ‡è®°ï¼Œå³meta tagã€‚</p><p>æ¯”å¦‚è¦å®Œå…¨é˜»æ­¢ä¸€ä¸ªç½‘é¡µçš„å†…å®¹åˆ—åœ¨æœç´¢å¼•æ“ç´¢å¼•ä¸­(å³ä½¿æœ‰å…¶ä»–ç½‘ç«™é“¾æ¥åˆ°æ­¤ç½‘é¡µ)ï¼Œå¯ä½¿ç”¨ noindex å…ƒæ ‡è®°ã€‚åªè¦æœç´¢å¼•æ“æŸ¥çœ‹è¯¥ç½‘é¡µï¼Œä¾¿ä¼šçœ‹åˆ° noindex å…ƒæ ‡è®°å¹¶é˜»æ­¢è¯¥ç½‘é¡µæ˜¾ç¤ºåœ¨ç´¢å¼•ä¸­ï¼Œè¿™é‡Œæ³¨æ„noindexå…ƒæ ‡è®°æä¾›çš„æ˜¯ä¸€ç§é€é¡µæ§åˆ¶å¯¹ç½‘ç«™çš„è®¿é—®çš„æ–¹å¼ã€‚</p><p>è¦é˜²æ­¢æ‰€æœ‰æœç´¢å¼•æ“å°†ç½‘ç«™ä¸­çš„ç½‘é¡µç¼–å…¥ç´¢å¼•ï¼Œåœ¨ç½‘é¡µçš„éƒ¨åˆ†æ·»åŠ ï¼š</p><pre class="line-numbers language-vbscript-html" data-language="vbscript-html"><code class="language-vbscript-html">&lt;meta name="robots" content="noindex"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„nameå–å€¼å¯ä»¥è®¾ç½®ä¸ºæŸä¸ªæœç´¢å¼•æ“çš„User-agentä»è€ŒæŒ‡å®šå±è”½æŸä¸€ä¸ªæœç´¢å¼•æ“ã€‚</p><p>é™¤äº†noindexå¤–ï¼Œè¿˜æœ‰å…¶ä»–å…ƒæ ‡è®°ï¼Œæ¯”å¦‚è¯´nofollowï¼Œç¦æ­¢çˆ¬è™«ä»æ­¤é¡µé¢ä¸­è·Ÿè¸ªé“¾æ¥ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒGoogleæ”¯æŒçš„å…ƒæ ‡è®°ï¼Œè¿™é‡Œæä¸€å¥ï¼šnoindexå’Œnofollowåœ¨HTML 4.01è§„èŒƒé‡Œæœ‰æè¿°ï¼Œä½†æ˜¯å…¶ä»–tagçš„åœ¨ä¸åŒå¼•æ“æ”¯æŒåˆ°ä»€ä¹ˆç¨‹åº¦å„ä¸ç›¸åŒï¼Œè¿˜è¯·è¯»è€…è‡ªè¡ŒæŸ¥é˜…å„ä¸ªå¼•æ“çš„è¯´æ˜æ–‡æ¡£ã€‚</p><p><strong>Crawl-delay</strong><br>é™¤äº†æ§åˆ¶å“ªäº›å¯ä»¥æŠ“å“ªäº›ä¸èƒ½æŠ“ä¹‹å¤–ï¼Œrobots.txtè¿˜å¯ä»¥ç”¨æ¥æ§åˆ¶çˆ¬è™«æŠ“å–çš„é€Ÿç‡ã€‚å¦‚ä½•åšåˆ°çš„å‘¢?é€šè¿‡è®¾ç½®çˆ¬è™«åœ¨ä¸¤æ¬¡æŠ“å–ä¹‹é—´ç­‰å¾…çš„ç§’æ•°ã€‚è¿™ç§æ“ä½œå¯ä»¥è¿›è¡Œç¼“è§£æœåŠ¡å™¨å‹åŠ›ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Crawl-delay:5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¡¨ç¤ºæœ¬æ¬¡æŠ“å–åä¸‹ä¸€æ¬¡æŠ“å–å‰éœ€è¦ç­‰å¾…5ç§’ã€‚</p><p>æ³¨æ„ï¼šgoogleå·²ç»ä¸æ”¯æŒè¿™ç§æ–¹å¼äº†ï¼Œåœ¨webmaster toolsé‡Œæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¯ä»¥æ›´ç›´è§‚çš„æ§åˆ¶æŠ“å–é€Ÿç‡ã€‚</p><p>è¿™é‡Œæ’ä¸€å¥é¢˜å¤–è¯ï¼Œå‡ å¹´å‰æ›¾ç»æœ‰ä¸€æ®µæ—¶é—´robots.txtè¿˜æ”¯æŒå¤æ‚çš„å‚æ•°:Visit-timeï¼Œåªæœ‰åœ¨visit-timeæŒ‡å®šçš„æ—¶é—´æ®µé‡Œï¼Œçˆ¬è™«æ‰å¯ä»¥è®¿é—®;Request-rate: ç”¨æ¥é™åˆ¶URLçš„è¯»å–é¢‘ç‡ï¼Œç”¨äºæ§åˆ¶ä¸åŒçš„æ—¶é—´æ®µé‡‡ç”¨ä¸åŒçš„æŠ“å–é€Ÿç‡ã€‚åæ¥ä¼°è®¡æ”¯æŒçš„äººå¤ªå°‘ï¼Œå°±æ¸æ¸çš„åºŸæ‰äº†ï¼Œç›®å‰googleå’Œbaiduéƒ½å·²ç»ä¸æ”¯æŒè¿™ä¸ªè§„åˆ™äº†ï¼Œå…¶ä»–å°çš„å¼•æ“å…¬å¸è²Œä¼¼ä»æ¥éƒ½æ²¡æœ‰æ”¯æŒè¿‡ã€‚</p><h3 id="Robotsåè®®çš„éµå®ˆæ–¹å¼"><a href="#Robotsåè®®çš„éµå®ˆæ–¹å¼" class="headerlink" title="Robotsåè®®çš„éµå®ˆæ–¹å¼"></a>Robotsåè®®çš„éµå®ˆæ–¹å¼</h3><p>ç½‘ç»œçˆ¬è™«ï¼š<br>è‡ªåŠ¨æˆ–äººå·¥è¯†åˆ«rotbots.txtï¼Œå†è¿›è¡Œå†…å®¹çˆ¬å–<br>çº¦æŸæ€§:<br>Robotsåè®®æ˜¯å»ºè®®ä½†éçº¦æŸæ€§ï¼Œç½‘ç»œçˆ¬è™«å¯ä»¥ä¸éµå®ˆï¼Œä½†å­˜åœ¨æ³•å¾‹é£é™©ã€‚</p><h3 id="å¯¹Robotsåè®®çš„ç†è§£"><a href="#å¯¹Robotsåè®®çš„ç†è§£" class="headerlink" title="å¯¹Robotsåè®®çš„ç†è§£"></a>å¯¹Robotsåè®®çš„ç†è§£</h3><table><thead><tr><th>è®¿é—®é‡å°:å¯ä»¥éµå®ˆ<br>è®¿é—®é‡è¾ƒå¤§ï¼šå»ºè®®éµå®ˆ</th><th>éå•†ä¸šä¸”å¶å°”:å»ºè®®éµå®ˆ<br>å•†ä¸šåˆ©ç›Š:å¿…é¡»éµå®ˆ</th><th>å¿…é¡»éµå®ˆ</th></tr></thead><tbody><tr><td>çˆ¬å–ç½‘é¡µ ç©è½¬ç½‘é¡µ</td><td>çˆ¬å–ç½‘ç«™ çˆ¬å–ç³»åˆ—ç½‘ç«™</td><td>çˆ¬å–å…¨ç½‘</td></tr><tr><td><code>åŸåˆ™</code>ï¼šç±»äººè¡Œä¸ºå¯ä»¥ä¸å‚è€ƒRobotsåè®®ã€‚</td><td></td><td></td></tr></tbody></table><h3 id="é˜²å›å­ä¸é˜²å°äººï¼ˆå›å­åè®®ï¼‰"><a href="#é˜²å›å­ä¸é˜²å°äººï¼ˆå›å­åè®®ï¼‰" class="headerlink" title="é˜²å›å­ä¸é˜²å°äººï¼ˆå›å­åè®®ï¼‰"></a>é˜²å›å­ä¸é˜²å°äººï¼ˆå›å­åè®®ï¼‰</h3><p>Robotsåè®®ä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯å£å’ï¼Œè€Œåªæ˜¯ä¸€ç§äº’ç›¸å°Šé‡çš„åè®®ï¼Œå¥½æ¯”ç§å®¶èŠ±å›­çš„é—¨å£æŒ‚ç€â€œé—²äººå…è¿›â€ï¼Œå°Šé‡è€…ç»•é“è€Œè¡Œï¼Œä¸å°Šé‡è€…ä¾ç„¶å¯ä»¥æ¨é—¨è€Œå…¥ã€‚ç›®å‰ï¼ŒRobotsåè®®åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>robots.txtæœ¬èº«ä¹Ÿæ˜¯éœ€è¦æŠ“å–çš„ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œä¸€èˆ¬çˆ¬è™«ä¸ä¼šæ¯æ¬¡æŠ“å–ç½‘ç«™ç½‘é¡µå‰éƒ½æŠ“ä¸€ä¸‹robots.txtï¼ŒåŠ ä¸Šrobots.txtæ›´æ–°ä¸é¢‘ç¹ï¼Œå†…å®¹éœ€è¦è§£æã€‚é€šå¸¸çˆ¬è™«çš„åšæ³•æ˜¯å…ˆæŠ“å–ä¸€æ¬¡ï¼Œè§£æåç¼“å­˜ä¸‹æ¥ï¼Œè€Œä¸”æ˜¯ç›¸å½“é•¿çš„æ—¶é—´ã€‚å‡è®¾ç½‘ç«™ç®¡ç†å‘˜æ›´æ–°äº†robots.txtï¼Œä¿®æ”¹äº†æŸäº›è§„åˆ™ï¼Œä½†æ˜¯å¯¹çˆ¬è™«æ¥è¯´å¹¶ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œåªæœ‰å½“çˆ¬è™«ä¸‹æ¬¡æŠ“å–robots.txtä¹‹åæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„å†…å®¹ã€‚å°´å°¬çš„æ˜¯ï¼Œçˆ¬è™«ä¸‹æ¬¡æŠ“å–robots.txtçš„æ—¶é—´å¹¶ä¸æ˜¯ç”±ç½‘ç«™ç®¡ç†å‘˜æ§åˆ¶çš„ã€‚å½“ç„¶ï¼Œæœ‰äº›æœç´¢å¼•æ“æä¾›äº†web å·¥å…·å¯ä»¥è®©ç½‘ç«™ç®¡ç†å‘˜é€šçŸ¥æœç´¢å¼•æ“é‚£ä¸ªurlå‘ç”Ÿäº†å˜åŒ–ï¼Œå»ºè®®é‡æ–°æŠ“å–ã€‚æ³¨æ„ï¼Œæ­¤å¤„æ˜¯å»ºè®®ï¼Œå³ä½¿ä½ é€šçŸ¥äº†æœç´¢å¼•æ“ï¼Œæœç´¢å¼•æ“ä½•æ—¶æŠ“å–ä»ç„¶æ˜¯ä¸ç¡®å®šçš„ï¼Œåªæ˜¯æ¯”å®Œå…¨ä¸é€šçŸ¥è¦å¥½ç‚¹ã€‚è‡³äºå¥½å¤šå°‘ï¼Œé‚£å°±çœ‹æœç´¢å¼•æ“çš„è‰¯å¿ƒå’ŒæŠ€æœ¯èƒ½åŠ›äº†ã€‚</p><h3 id="ignore"><a href="#ignore" class="headerlink" title="ignore"></a>ignore</h3><p>ä¸çŸ¥æ˜¯æ— æ„è¿˜æ˜¯æœ‰æ„ï¼Œåæ­£æœ‰äº›çˆ¬è™«ä¸å¤ªéµå®ˆæˆ–è€…å®Œå…¨å¿½ç•¥robots.txtï¼Œä¸æ’é™¤å¼€å‘äººå‘˜èƒ½åŠ›çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´æ ¹æœ¬ä¸çŸ¥é“robots.txtã€‚å¦å¤–ï¼Œæœ¬èº«robots.txtä¸æ˜¯ä¸€ç§å¼ºåˆ¶æªæ–½ï¼Œå¦‚æœç½‘ç«™æœ‰æ•°æ®éœ€è¦ä¿å¯†ï¼Œå¿…éœ€é‡‡å–æŠ€æœ¯æªæ–½ï¼Œæ¯”å¦‚è¯´ï¼šç”¨æˆ·éªŒè¯ï¼ŒåŠ å¯†ï¼Œipæ‹¦æˆªï¼Œè®¿é—®é¢‘ç‡æ§åˆ¶ç­‰ã€‚</p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/nGoP78.jpg"></p><h3 id="æ¶æ„çˆ¬è™«"><a href="#æ¶æ„çˆ¬è™«" class="headerlink" title="æ¶æ„çˆ¬è™«"></a>æ¶æ„çˆ¬è™«</h3><p>åœ¨äº’è”ç½‘ä¸–ç•Œä¸­ï¼Œæ¯å¤©éƒ½æœ‰ä¸è®¡å…¶æ•°çš„çˆ¬è™«åœ¨æ—¥å¤œä¸æ¯åœ°çˆ¬å–æ•°æ®ï¼Œå…¶ä¸­æ¶æ„çˆ¬è™«çš„æ•°é‡ç”šè‡³é«˜äºéæ¶æ„çˆ¬è™«ã€‚éµå®ˆRobotsåè®®çš„çˆ¬è™«æ‰æ˜¯å¥½çˆ¬è™«ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸ªçˆ¬è™«éƒ½ä¼šä¸»åŠ¨éµå®ˆRobotsåè®®ã€‚</p><p>æ¶æ„çˆ¬è™«å¯ä»¥å¸¦æ¥å¾ˆå¤šæ½œåœ¨å¨èƒï¼Œæ¯”å¦‚ç”µå•†ç½‘ç«™çš„å•†å“ä¿¡æ¯è¢«çˆ¬å–å¯èƒ½ä¼šè¢«ç«äº‰å¯¹æ‰‹åˆ©ç”¨ï¼Œè¿‡å¤šçš„çˆ¬è™«è¿˜ä¼šå ç”¨å¸¦å®½èµ„æºã€ç”šè‡³å¯¼è‡´ç½‘ç«™å®•æœºã€‚</p><p>åæ¶æ„çˆ¬è™«æ˜¯ä¸€ä»¶æ¼«é•¿è€Œè‰°å·¨çš„ä»»åŠ¡ï¼Œå¦‚æœä¾é è‡ªèº«å®åŠ›éš¾ä»¥è§£å†³ï¼Œå¯ä»¥å€ŸåŠ©å²‚å®‰ç§‘æŠ€çš„ä¸šåŠ¡é£é™©åˆ†æå¹³å° WARDEN æ¥åæ¶æ„çˆ¬è™«ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®šåˆ¶åŠŸèƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crawler </tag>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> robots </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2021/07/31/hello-world/"/>
      <url>/2021/07/31/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(æ•ˆç‡å·¥å…·)ç¨‹åºå‘˜å¿…å¤‡ç»ˆç«¯åŠç¾åŒ–</title>
      <link href="/2021/07/31/iterm/"/>
      <url>/2021/07/31/iterm/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/QicdYL.jpg"></p><p>ä½œä¸ºä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜ï¼ŒCLIæ˜¯å¿…å¤‡çš„æŠ€èƒ½ã€‚ å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ä¸€ä¸ªé¡ºæ‰‹å¹¶ä¸”æé«˜æ•ˆç‡çš„ç»ˆç«¯æ˜¯å¿…é¡»çš„ã€‚ å¹³æ—¶å¾ˆå¤šäººä¼šç§ä¿¡æˆ–è¯„è®ºä¸­é—®æˆ‘å…³äºæˆ‘çš„ç»ˆç«¯ç›¸å…³çš„å†…å®¹ï¼Œä»Šå¤©æˆ‘æ•´ç†å‡ºæ¥ã€‚åˆ†äº«ç»™å¤§å®¶ã€‚</p><h4 id="éœ€è¦å®‰è£…çš„è½¯ä»¶"><a href="#éœ€è¦å®‰è£…çš„è½¯ä»¶" class="headerlink" title="éœ€è¦å®‰è£…çš„è½¯ä»¶"></a>éœ€è¦å®‰è£…çš„è½¯ä»¶</h4><blockquote><ol><li>iterm2</li><li>dracula</li><li>zsh</li><li>Oh My ZSH</li><li>powerlevel10k</li></ol></blockquote><p>ä¸Šé¢ğŸ‘†ç»™å‡ºäº†éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œ ä¸‹é¢å°±æŒ‰å®‰è£…çš„é¡ºåºä¸€ä¸ªä¸€ä¸ªä»‹ç»</p><h3 id="ä¸€ã€iterm2"><a href="#ä¸€ã€iterm2" class="headerlink" title="ä¸€ã€iterm2"></a>ä¸€ã€iterm2</h3><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/Wbh9jA.jpg"></p><p>è¿™ä¸ªå°±ä¸å¤šä»‹ç»ï¼Œ æˆ‘ç›¸ä¿¡åªè¦æ˜¯ä½¿ç”¨macçš„ç¨‹åºå‘˜ï¼Œè¿™ä¸ªéƒ½æ˜¯çŸ¥é“çš„ï¼Œ å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå…¶ä»–ç±»ä¼¼çš„äº§å“ã€‚ åé¢å®‰è£…çš„å’Œiterm2æ²¡æœ‰å¼ºä¾èµ–ã€‚ è¿™åªæ˜¯ä¸€ä¸ªç»ˆç«¯ï¼Œ æ²¡æœ‰æœ€å¥½ï¼Œé€‚åˆä½ çš„å°±æ˜¯æœ€å¥½çš„ã€‚ é¡ºä¾¿æä¸€ä¸‹ï¼Œ æˆ‘è‡ªå·±çš„ğŸ’»ä½¿ç”¨touch barçš„ï¼Œ æ˜¯æ”¯æŒtouch barï¼Œä¸€äº›å¾ˆç‚«çš„æ“ä½œå¯ä»¥åœ¨touch barä¸Šæ“ä½œã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨å…¬å¸çš„ç¬”è®°æœ¬ï¼Œä½¿ç”¨å¿«æ·é”®è¿›è¡Œæ“ä½œï¼Œ æ•ˆç‡æ›´é«˜ã€‚</p><p><a href="https://www.iterm2.com/">å®˜ç½‘</a></p><h4 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h4><p>1). æ–¹å¼ä¸€<br><a href="https://www.iterm2.com/downloads.html">ä¸‹è½½åœ°å€</a>ï¼Œ ä¸‹è½½åï¼Œç‚¹å‡»å®‰è£…å°±å¯ä»¥äº†</p><p>2). æ–¹å¼äºŒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew cask <span class="token function">install</span> iterm2   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>brewä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†</p><h4 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2. ä½¿ç”¨"></a>2. ä½¿ç”¨</h4><p><a href="https://www.iterm2.com/documentation.html">æ–‡æ¡£</a><br>è¿™é‡Œé¡ºä¾¿ä»‹ç»ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯å¿«æ·é”®, è‡ªå·±å¯¹ç€æ–‡æ¡£ï¼Œå­¦ä¹ ä¸€ä¸‹ï¼Œ å› ä¸ºé‡ç‚¹ä¸åœ¨è¿™ã€‚<br><code>CMD + å•å‡»</code> å¯ä»¥å®ç°è·³è½¬</p><h3 id="äºŒã€-å®‰è£…é…ç½®draculaä¸»é¢˜"><a href="#äºŒã€-å®‰è£…é…ç½®draculaä¸»é¢˜" class="headerlink" title="äºŒã€ å®‰è£…é…ç½®draculaä¸»é¢˜"></a>äºŒã€ å®‰è£…é…ç½®draculaä¸»é¢˜</h3><p>è¿™ä¸ªä¹Ÿæœ‰ä¸¤ç§æ–¹å¼</p><ol><li>ä½¿ç”¨git<br><code>git clone https://github.com/dracula/iterm.git</code></li><li>ç›´æ¥ä¸‹è½½ï¼Œè§£å‹<br>ä¸‹è½½åœ°å€ <a href="https://github.com/dracula/iterm/archive/master.zip">GitHub .zip download</a></li></ol><p><em>ä½¿ç”¨ä¸»é¢˜</em><br>é…ç½®è¿‡ç¨‹å¦‚ä¸‹</p><blockquote><ol><li>æ‰“å¼€ iTerm2 &gt; Preferences &gt; Profiles &gt; Colors Tabï¼Œ é€‰æ‹©color</li><li>ç‚¹å‡»ä¸‹é¢çš„<code>Color Presets</code>,å±•å¼€</li><li>é€‰æ‹©<code>import</code>, å°†ä¸Šé¢ğŸ‘†ä¸‹è½½çš„æ–‡ä»¶å¯¼å…¥</li><li>é€‰æ‹©<code>Dracula.itermcolors</code>æ–‡ä»¶å¯¼å…¥</li><li>å¯¼å…¥ä»¥åï¼Œé‡æ–°é€‰æ‹© <code>Color Presets</code>ï¼Œé€‰æ‹© <code>dracula</code>å°±å¯ä»¥äº†<br> å…·ä½“å¦‚ä¸‹ï¼š<br> <img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/FLOTC9.jpg"></li></ol></blockquote><h3 id="ä¸‰ã€Oh-My-ZSH"><a href="#ä¸‰ã€Oh-My-ZSH" class="headerlink" title="ä¸‰ã€Oh My ZSH"></a>ä¸‰ã€Oh My ZSH</h3><p><a href="%5Bhttps://ohmyz.sh/%5D(https://ohmyz.sh/)">Oh My ZSH</a><br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/1zZOJy.jpg"></p><ol><li><p>å…ˆå®‰è£… zsh<br>ä¸‹é¢åªç»™å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…</span>brew <span class="token function">install</span> <span class="token function">zsh</span> zsh-completions<span class="token comment"># åˆ‡æ¢shell</span>chsh -s /bin/zsh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®‰è£…Oh My ZSH<br>ä¸‹é¢é€‰ä¸€ç§</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="token variable">)</span></span>"</span><span class="token comment"># or</span><span class="token function">sh</span> -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">wget</span> https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -<span class="token variable">)</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹ä¸‹è„šæœ¬å†…å®¹ï¼Œå®šä¹‰äº†å®‰è£…ç›®å½•ä»€ä¹ˆçš„ï¼Œå’Œå¸¸è§çš„å®‰è£…shellæ²¡æœ‰åŒºåˆ«ã€‚</p></li><li><p>å…³é—­iterm2, ç„¶åå†æ‰“å¼€ï¼Œå°±ç”Ÿæ•ˆäº†</p></li><li><p>é…ç½® ä¸€ä¸ªæ’ä»¶<br>é…ç½®åœ¨ <code>.zshrc</code>æ–‡ä»¶ä¸­ï¼Œé…ç½®å¾ˆç®€å•<br>å¯ä»¥ä½¿ç”¨çš„æ’ä»¶ä»¥åŠæè¿° <a href="https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins">github</a></p></li></ol><h3 id="å››ã€powerlevel10k"><a href="#å››ã€powerlevel10k" class="headerlink" title="å››ã€powerlevel10k"></a>å››ã€powerlevel10k</h3><p><a href="https://github.com/romkatv/powerlevel10k">githubåœ°å€</a></p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/DUuyUe.jpg"></p><ol><li>å®‰è£…ä¸»é¢˜<br>ä¹Ÿæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œ è¿™é‡Œä½¿ç”¨git<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone --depth<span class="token operator">=</span><span class="token number">1</span> https://github.com/romkatv/powerlevel10k.git <span class="token variable">${ZSH_CUSTOM<span class="token operator">:-</span>$HOME<span class="token operator">/</span>.oh-my-zsh<span class="token operator">/</span>custom}</span>/themes/powerlevel10k<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>åœ¨ <code>.zshrc</code>ä¸­é…ç½®ä¸»é¢˜ç”Ÿæ•ˆï¼Œé€€å‡ºï¼Œ å°±å¯ä»¥ç”Ÿæ•ˆ<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ZSH_THEME</span><span class="token operator">=</span><span class="token string">"powerlevel10k/powerlevel10k"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…å­—ä½“ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…æ‰€éœ€å­—ä½“ã€‚<br>ä¸€äº›éœ€è¦å­—ä½“å®‰è£…çš„æ–‡æ¡£ <a href="https://github.com/bhilburn/powerlevel9k/wiki/Install-Instructions#step-2-install-a-powerline-font">install-a-powerline-font</a><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># clone</span><span class="token function">git</span> clone https://github.com/powerline/fonts.git<span class="token comment"># install</span><span class="token builtin class-name">cd</span> fonts./install.sh<span class="token comment"># clean-up a bit</span><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token function">rm</span> -rf fonts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>å­—ä½“å®‰è£…å®Œæ¯•ä¹‹åï¼Œæ‰“å¼€ Shell ä½ ä¼šå‘ç°å­—ä½“ä¾ç„¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œè¿™æ˜¯å› ä¸ºä½ æ²¡æœ‰é€‰æ‹©å¯¹åº”çš„å­—ä½“ã€‚åœ¨è®¾ç½®ä¸­é€‰æ‹©ä½ æƒ³è¦çš„æ”¯æŒå­—ä½“ã€‚<br>å¦‚æœæœ‰ä¸€äº›ç‰¹æ®Šçš„å›¾æ ‡ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œ å¯èƒ½éœ€è¦å®‰è£… <a href="https://github.com/gabrielelana/awesome-terminal-fonts">awesome-terminal-fonts</a>å­—ä½“</p><p>è¿˜æœ‰ä¸€äº›å›¾æ ‡ï¼Œæ¯”å¦‚github,gitlab, git,linuxçš„ä¸€äº›å›¾æ ‡åœ¨<code>/Users/youdi/.oh-my-zsh/custom/themes/powerlevel9k/functions/icons.zsh</code>ä¸­ä¿®æ”¹ã€‚</p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/Mob8Xk.jpg"></p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>æˆ‘ä½¿ç”¨ <code>colorls</code>,æ˜¯rubyçš„çš„å·¥å…·,<br><a href="%5Bhttps://github.com/athityakumar/colorls%5D(https://github.com/athityakumar/colorls)">å®‰è£…</a><br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/vjJGRU.jpg"></p><p>å¦å¤–ä¸€ä¸ªæŸ¥çœ‹æ€§èƒ½çš„å·¥å…· <code>gotop</code>, ä½ è‚¯å®šç”¨è¿‡ <code>top</code>,<code>htop</code><br><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/8cEKLj.jpg"></p><p><a href="%5Bhttps://github.com/cjbassi/gotop%5D(https://github.com/cjbassi/gotop)">æºç </a>, ç±»ä¼¼çš„ topçš„å·¥å…·å¾ˆå¤šï¼Œå„ä¸ªè¯­è¨€ç‰ˆæœ¬çš„éƒ½æœ‰ï¼Œ æˆ‘æ¯”è¾ƒå–œæ¬¢ç¼–è¯‘å‹è¯­è¨€çš„ç‰ˆæœ¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
            <tag> zsh </tag>
            
            <tag> powerlevel10k </tag>
            
            <tag> dracula </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go modä½¿ç”¨</title>
      <link href="/2021/07/31/go-mod-use/"/>
      <url>/2021/07/31/go-mod-use/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ç”±äºæ¢å·¥ä½œï¼Œå¼€å§‹äº¤æ¥å·¥ä½œã€‚æ•´ç†ä»¥å‰çš„å·¥ä½œå†…å®¹ï¼Œç”±äºç»„å†…å°±æˆ‘ä¸€ä¸ªåœ¨åšgoå’Œå¤§æ•°æ®ã€‚ æ‰€ä»¥å¼€å‘æ²¡æœ‰è§„åˆ’ï¼Œå½“æ—¶æ˜¯æ€ä¹ˆå¿«æ€ä¹ˆæ¥ã€‚goä¹Ÿæ˜¯ä½¿ç”¨æœ€ä¼ ç»Ÿçš„go pathçš„æ–¹å¼ç®¡ç†çš„ã€‚éƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ä¾èµ–çš„ã€‚ç°åœ¨äº¤æ¥ç»™ä»–äººï¼Œéœ€è¦å¤šäººå¼€å‘ï¼Œå‘ç°å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚ç‰ˆæœ¬é—®é¢˜ï¼Œå„ç§ä¾èµ–çš„é—®é¢˜ç­‰ç­‰ã€‚</p><p>ç”±äºå·¥ä½œåŸå› ï¼Œå‡ ä¹æ‰€æœ‰ä¸»æµè¯­è¨€éƒ½å†™è¿‡ã€‚æ‰€ä»¥ï¼Œå¯¹åº”è¯­è¨€åŒ…ç®¡ç†å·¥å…·ä¹Ÿéƒ½äº†è§£å’Œä½¿ç”¨è¿‡ã€‚æˆ‘å‰é¢æœ‰å†™è¿‡mavençš„ä½¿ç”¨ã€‚<br>mavenæ˜¯ä½¿ç”¨è¿‡çš„åŠŸèƒ½æœ€å¼ºå¤§çš„åŒ…ç®¡ç†å·¥å…·äº†ï¼Œmavenå®šä½æ˜¯é¡¹ç›®ç®¡ç†å·¥å…·ã€‚pipå’Œnpméƒ½æ˜¯åŠæ ¼çš„äº§å“ã€‚</p><p>æˆ‘ä¸ªäººè§‰å¾—ï¼Œä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·åº”è¯¥æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><h3 id="åŸºæœ¬åŠŸèƒ½"><a href="#åŸºæœ¬åŠŸèƒ½" class="headerlink" title="åŸºæœ¬åŠŸèƒ½"></a>åŸºæœ¬åŠŸèƒ½</h3><ol><li>ä¾èµ–ç®¡ç†</li><li>ä¾èµ–åŒ…ç‰ˆæœ¬æ§åˆ¶</li><li>å¯¹åº”çš„åŒ…ç®¡ç†å¹³å°</li><li>å¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²</li></ol><p>åŠ åˆ†ï¼š<br>5. ä»£ç åŒ…æ˜¯å¦å¯ä»¥å¤ç”¨<br>6. æ„å»ºï¼Œæµ‹è¯•,æ‰“åŒ…<br>7. å‘å¸ƒä¸Šçº¿</p><p>å¯¹æ¯”ä¸Šé¢å‡ ç‚¹ï¼š<br>ç›®å‰åšçš„æœ€å¥½çš„ä¹Ÿå°± mavenäº†ï¼Œgradleæ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œä¸çŸ¥é“ã€‚</p><p>ä»Šå¤©ä¸»è§’æ˜¯go modï¼Œå…ˆæ¥è°ˆè°ˆæ²¡æœ‰ä½¿ç”¨go modä¹‹å‰çš„é—®é¢˜ã€‚</p><h3 id="ä½¿ç”¨go-pathé—®é¢˜"><a href="#ä½¿ç”¨go-pathé—®é¢˜" class="headerlink" title="ä½¿ç”¨go pathé—®é¢˜"></a>ä½¿ç”¨go pathé—®é¢˜</h3><ol><li>ä»£ç å¼€å‘å¿…é¡»åœ¨go path srcç›®å½•ä¸‹ï¼Œä¸ç„¶ï¼Œå°±æœ‰é—®é¢˜ã€‚</li><li>ä¾èµ–æ‰‹åŠ¨ç®¡ç†</li><li>ä¾èµ–åŒ…æ²¡æœ‰ç‰ˆæœ¬å¯è¨€</li></ol><p>ä»è¿™ä¸ªçœ‹ï¼Œ go pathä¸ç®—åŒ…ç®¡ç†å·¥å…·</p><h3 id="govendor"><a href="#govendor" class="headerlink" title="govendor"></a>govendor</h3><ol><li>è§£å†³äº†åŒ…ä¾èµ–ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶å°±ç®¡ç†</li><li>ä¾èµ–åŒ…å…¨éƒ½ä¸‹è½½åˆ°é¡¹ç›®vendorä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½æŠŠæœ‰ä¸€ä»½ã€‚æ‹‰å–é¡¹ç›®æ—¶,å¼€å§‹æ€€ç–‘äººç”Ÿã€‚</li></ol><h3 id="go-modä»‹ç»"><a href="#go-modä»‹ç»" class="headerlink" title="go modä»‹ç»"></a>go modä»‹ç»</h3><p>go modules æ˜¯ golang 1.11 æ–°åŠ çš„ç‰¹æ€§ã€‚ç°åœ¨1.12 å·²ç»å‘å¸ƒäº†ï¼Œæ˜¯æ—¶å€™ç”¨èµ·æ¥äº†ã€‚Moduleså®˜æ–¹å®šä¹‰ä¸ºï¼š</p><blockquote><p>æ¨¡å—æ˜¯ç›¸å…³GoåŒ…çš„é›†åˆã€‚modulesæ˜¯æºä»£ç äº¤æ¢å’Œç‰ˆæœ¬æ§åˆ¶çš„å•å…ƒã€‚ goå‘½ä»¤ç›´æ¥æ”¯æŒä½¿ç”¨modulesï¼ŒåŒ…æ‹¬è®°å½•å’Œè§£æå¯¹å…¶ä»–æ¨¡å—çš„ä¾èµ–æ€§ã€‚modulesæ›¿æ¢æ—§çš„åŸºäºGOPATHçš„æ–¹æ³•æ¥æŒ‡å®šåœ¨ç»™å®šæ„å»ºä¸­ä½¿ç”¨å“ªäº›æºæ–‡ä»¶ã€‚</p></blockquote><h3 id="å¦‚ä½•ä½¿ç”¨go-mod"><a href="#å¦‚ä½•ä½¿ç”¨go-mod" class="headerlink" title="å¦‚ä½•ä½¿ç”¨go mod"></a>å¦‚ä½•ä½¿ç”¨go mod</h3><p>é¦–å…ˆï¼Œå¿…é¡»å‡çº§goåˆ°1.11,ç›®å‰ç‰ˆæœ¬æ˜¯1.14<br>ä¸‹é¢æˆ‘ä»¥æˆ‘è‡ªå·±å‡çº§æ¼”ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">### å¸è½½æ—§ç‰ˆæœ¬ï¼Œåˆ é™¤å¯¹åº”æ–‡ä»¶</span>brew uninstall -f go<span class="token comment">### æ›´æ–°ä¸€ä¸‹brew</span>brew update<span class="token comment">### å®‰è£…go</span>brew <span class="token function">install</span> go<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å‡çº§å®Œäº†ï¼Œä½¿ç”¨ <code>go version</code>çœ‹ä¸‹ç‰ˆæœ¬</p><pre class="line-numbers language-none"><code class="language-none">go version go1.14.1 darwin/amd64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹é¢è®¾ç½®go modå’Œgo proxy</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go <span class="token function">env</span> -w <span class="token assign-left variable">GOBIN</span><span class="token operator">=</span>/Users/youdi/go/bingo <span class="token function">env</span> -w <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>ongo <span class="token function">env</span> -w <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct // ä½¿ç”¨ä¸ƒç‰›äº‘çš„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼š go env -wä¼šå°†é…ç½®å†™åˆ°  <code>GOENV="/Users/youdi/Library/Application Support/go/env"</code></p><p>ä¸‹é¢çœ‹ä¸‹æˆ‘çš„é…ç½®</p><pre class="line-numbers language-none"><code class="language-none">GO111MODULE="on"GOARCH="amd64"GOBIN="/Users/youdi/go/bin"GOCACHE="/Users/youdi/Library/Caches/go-build"GOENV="/Users/youdi/Library/Application Support/go/env"GOEXE=""GOFLAGS=""GOHOSTARCH="amd64"GOHOSTOS="darwin"GOINSECURE=""GONOPROXY=""GONOSUMDB=""GOOS="darwin"GOPATH="/Users/youdi/go"GOPRIVATE=""GOPROXY="https://goproxy.cn,direct"GOROOT="/usr/local/go"GOSUMDB="off"GOTMPDIR=""GOTOOLDIR="/usr/local/go/pkg/tool/darwin_amd64"GCCGO="gccgo"AR="ar"CC="clang"CXX="clang++"CGO_ENABLED="1"GOMOD="/dev/null"CGO_CFLAGS="-g -O2"CGO_CPPFLAGS=""CGO_CXXFLAGS="-g -O2"CGO_FFLAGS="-g -O2"CGO_LDFLAGS="-g -O2"PKG_CONFIG="pkg-config"GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/8m/v_1j4dgs7rzgqq4p_4_8k_nr0000gn/T/go-build221113671=/tmp/go-build -gno-record-gcc-switches -fno-common"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä¿®æ”¹çš„å†…å®¹</p><p>cat /Users/youdi/Library/Application Support/go/env</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on<span class="token assign-left variable">GOBIN</span><span class="token operator">=</span>/Users/youdi/go/bin<span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct<span class="token assign-left variable">GOSUMDB</span><span class="token operator">=</span>off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a>GO111MODULE</h3><p>GO111MODULE æœ‰ä¸‰ä¸ªå€¼ï¼šoff, onå’Œautoï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</p><p>GO111MODULE=offï¼Œgoå‘½ä»¤è¡Œå°†ä¸ä¼šæ”¯æŒmoduleåŠŸèƒ½ï¼Œå¯»æ‰¾ä¾èµ–åŒ…çš„æ–¹å¼å°†ä¼šæ²¿ç”¨æ—§ç‰ˆæœ¬é‚£ç§é€šè¿‡vendorç›®å½•æˆ–è€…GOPATHæ¨¡å¼æ¥æŸ¥æ‰¾ã€‚<br>GO111MODULE=onï¼Œgoå‘½ä»¤è¡Œä¼šä½¿ç”¨modulesï¼Œè€Œä¸€ç‚¹ä¹Ÿä¸ä¼šå»GOPATHç›®å½•ä¸‹æŸ¥æ‰¾ã€‚<br>GO111MODULE=autoï¼Œé»˜è®¤å€¼ï¼Œgoå‘½ä»¤è¡Œå°†ä¼šæ ¹æ®å½“å‰ç›®å½•æ¥å†³å®šæ˜¯å¦å¯ç”¨moduleåŠŸèƒ½ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å½¢ï¼š</p><pre><code>å½“å‰ç›®å½•åœ¨GOPATH/srcä¹‹å¤–ä¸”è¯¥ç›®å½•åŒ…å«go.modæ–‡ä»¶å½“å‰æ–‡ä»¶åœ¨åŒ…å«go.modæ–‡ä»¶çš„ç›®å½•ä¸‹é¢ã€‚</code></pre><p>å½“modulesåŠŸèƒ½å¯ç”¨æ—¶ï¼Œä¾èµ–åŒ…çš„å­˜æ”¾ä½ç½®å˜æ›´ä¸º$GOPATH/pkgï¼Œå…è®¸åŒä¸€ä¸ªpackageå¤šä¸ªç‰ˆæœ¬å¹¶å­˜ï¼Œä¸”å¤šä¸ªé¡¹ç›®å¯ä»¥å…±äº«ç¼“å­˜çš„ module</p><p>æˆ‘ä»¬çœ‹ä¸‹ç›®å½•ï¼š</p><p>cd /Users/youdi/go/pkg</p><pre class="line-numbers language-none"><code class="language-none">â”œâ”€â”€ darwin_amd64â”‚&nbsp;&nbsp; â”œâ”€â”€ github.comâ”‚&nbsp;&nbsp; â”œâ”€â”€ go.etcd.ioâ”‚&nbsp;&nbsp; â”œâ”€â”€ golangâ”‚&nbsp;&nbsp; â”œâ”€â”€ golang.orgâ”‚&nbsp;&nbsp; â”œâ”€â”€ gopkg.inâ”‚&nbsp;&nbsp; â”œâ”€â”€ quickstartâ”‚&nbsp;&nbsp; â””â”€â”€ uc.aâ”œâ”€â”€ modâ”‚&nbsp;&nbsp; â”œâ”€â”€ cacheâ”‚&nbsp;&nbsp; â”œâ”€â”€ github.comâ”‚&nbsp;&nbsp; â”œâ”€â”€ golang.orgâ”‚&nbsp;&nbsp; â”œâ”€â”€ google.golang.orgâ”‚&nbsp;&nbsp; â””â”€â”€ gopkg.inâ””â”€â”€ sumdb    â””â”€â”€ sum.golang.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="go-modå‘½ä»¤"><a href="#go-modå‘½ä»¤" class="headerlink" title="go modå‘½ä»¤"></a>go modå‘½ä»¤</h3><p>golang æä¾›äº† <code>go mod</code>å‘½ä»¤æ¥ç®¡ç†åŒ…ã€‚</p><p>go help mod</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Go mod provides access to operations on modules.Note that support <span class="token keyword">for</span> modules is built into all the go commands,not just <span class="token string">'go mod'</span><span class="token builtin class-name">.</span> For example, day-to-day adding, removing, upgrading,and downgrading of dependencies should be <span class="token keyword">done</span> using <span class="token string">'go get'</span><span class="token builtin class-name">.</span>See <span class="token string">'go help modules'</span> <span class="token keyword">for</span> an overview of module functionality.Usage:go mod <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span>The commands are:download    download modules to <span class="token builtin class-name">local</span> cacheedit        edit go.mod from tools or scriptsgraph       print module requirement graphinit        initialize new module <span class="token keyword">in</span> current directorytidy        <span class="token function">add</span> missing and remove unused modulesvendor      <span class="token function">make</span> vendored copy of dependenciesverify      verify dependencies have expected contentwhy         explain why packages or modules are neededUse <span class="token string">"go help mod &lt;command&gt;"</span> <span class="token keyword">for</span> <span class="token function">more</span> information about a command.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>go mod æœ‰ä»¥ä¸‹å‘½ä»¤ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>download</td><td>download modules to local cache(ä¸‹è½½ä¾èµ–åŒ…)</td></tr><tr><td>edit</td><td>edit go.mod from tools or scriptsï¼ˆç¼–è¾‘go.mod)</td></tr><tr><td>graph</td><td>print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾)</td></tr><tr><td>verify</td><td>initialize new module in current directoryï¼ˆåœ¨å½“å‰ç›®å½•åˆå§‹åŒ–modï¼‰</td></tr><tr><td>tidy</td><td>add missing and remove unused modules(æ‹‰å–ç¼ºå°‘çš„æ¨¡å—ï¼Œç§»é™¤ä¸ç”¨çš„æ¨¡å—)</td></tr><tr><td>vendor</td><td>make vendored copy of dependencies(å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹)</td></tr><tr><td>verify</td><td>verify dependencies have expected content (éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®ï¼‰</td></tr><tr><td>why</td><td>explain why packages or modules are needed(è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–)</td></tr></tbody></table><p>æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ <code>init</code>,<code>tidy</code>, <code>edit</code></p><h3 id="ä½¿ç”¨go-modç®¡ç†ä¸€ä¸ªæ–°é¡¹ç›®"><a href="#ä½¿ç”¨go-modç®¡ç†ä¸€ä¸ªæ–°é¡¹ç›®" class="headerlink" title="ä½¿ç”¨go modç®¡ç†ä¸€ä¸ªæ–°é¡¹ç›®"></a>ä½¿ç”¨go modç®¡ç†ä¸€ä¸ªæ–°é¡¹ç›®</h3><h4 id="1-åˆå§‹åŒ–é¡¹ç›®"><a href="#1-åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="1. åˆå§‹åŒ–é¡¹ç›®"></a>1. åˆå§‹åŒ–é¡¹ç›®</h4><p>å¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªç›®å½•åˆ›å»ºé¡¹ç›®ï¼Œæˆ‘ä½¿ç”¨ä¹ æƒ¯ç”¨IDEAè¿›è¡Œåˆ›å»º</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> Gone<span class="token builtin class-name">cd</span> Gonego mod init Gone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ä¸€ä¸‹ go.modæ–‡ä»¶</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">module Gone<span class="token keyword">go</span> <span class="token number">1.14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>go.modæ–‡ä»¶ä¸€æ—¦åˆ›å»ºåï¼Œå®ƒçš„å†…å®¹å°†ä¼šè¢«go toolchainå…¨é¢æŒæ§ã€‚go toolchainä¼šåœ¨å„ç±»å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œæ¯”å¦‚go getã€go buildã€go modç­‰ä¿®æ”¹å’Œç»´æŠ¤go.modæ–‡ä»¶ã€‚</p><p>go.mod æä¾›äº†module, requireã€replaceå’Œexclude å››ä¸ªå‘½ä»¤</p><ul><li><code>module</code> è¯­å¥æŒ‡å®šåŒ…çš„åå­—ï¼ˆè·¯å¾„ï¼‰</li><li><code>require</code> è¯­å¥æŒ‡å®šçš„ä¾èµ–é¡¹æ¨¡å—</li><li><code>replace</code> è¯­å¥å¯ä»¥æ›¿æ¢ä¾èµ–é¡¹æ¨¡å—</li><li><code>exclude</code> è¯­å¥å¯ä»¥å¿½ç•¥ä¾èµ–é¡¹æ¨¡å—</li></ul><h4 id="2-æ·»åŠ ä¾èµ–"><a href="#2-æ·»åŠ ä¾èµ–" class="headerlink" title="2. æ·»åŠ ä¾èµ–"></a>2. æ·»åŠ ä¾èµ–</h4><p>åˆ›å»º main.goæ–‡ä»¶</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"github.com/gin-gonic/gin"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/ping"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"pong"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œ go run main.go è¿è¡Œä»£ç ä¼šå‘ç° go mod ä¼šè‡ªåŠ¨æŸ¥æ‰¾ä¾èµ–è‡ªåŠ¨ä¸‹è½½<br>å†æŸ¥çœ‹ <code>go.mod</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">module Gonego <span class="token number">1.14</span>require github.com/gin-gonic/gin v1.6.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>go module å®‰è£… package çš„åŸå‰‡æ˜¯å…ˆæ‹‰æœ€æ–°çš„ release tagï¼Œè‹¥æ— tagåˆ™æ‹‰æœ€æ–°çš„commit</p><p>go ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª go.sum æ–‡ä»¶æ¥è®°å½• dependency tree</p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/JhSGHb.jpg"></p><p>å†æ¬¡æ‰§è¡Œè„šæœ¬ go run main.goå‘ç°è·³è¿‡äº†æ£€æŸ¥å¹¶å®‰è£…ä¾èµ–çš„æ­¥éª¤ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ go list -m -u all æ¥æ£€æŸ¥å¯ä»¥å‡çº§çš„packageï¼Œä½¿ç”¨go get -u need-upgrade-package å‡çº§åä¼šå°†æ–°çš„ä¾èµ–ç‰ˆæœ¬æ›´æ–°åˆ°go.mod * ä¹Ÿå¯ä»¥ä½¿ç”¨ go get -u å‡çº§æ‰€æœ‰ä¾èµ–</p><p>å»modåŒ…ç¼“å­˜ä¸‹çœ‹çœ‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/Users/youdi/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="go-getå‡çº§"><a href="#go-getå‡çº§" class="headerlink" title="go getå‡çº§"></a>go getå‡çº§</h3><ul><li>è¿è¡Œ go get -u å°†ä¼šå‡çº§åˆ°æœ€æ–°çš„æ¬¡è¦ç‰ˆæœ¬æˆ–è€…ä¿®è®¢ç‰ˆæœ¬(x.y.z, zæ˜¯ä¿®è®¢ç‰ˆæœ¬å·ï¼Œ yæ˜¯æ¬¡è¦ç‰ˆæœ¬å·)</li><li>è¿è¡Œ go get -u=patch å°†ä¼šå‡çº§åˆ°æœ€æ–°çš„ä¿®è®¢ç‰ˆæœ¬</li><li>è¿è¡Œ go get package@version å°†ä¼šå‡çº§åˆ°æŒ‡å®šçš„ç‰ˆæœ¬å·version</li><li>è¿è¡Œgo getå¦‚æœæœ‰ç‰ˆæœ¬çš„æ›´æ”¹ï¼Œé‚£ä¹ˆgo.modæ–‡ä»¶ä¹Ÿä¼šæ›´æ”¹</li></ul><h3 id="ä½¿ç”¨replaceæ›¿æ¢æ— æ³•ç›´æ¥è·å–çš„package"><a href="#ä½¿ç”¨replaceæ›¿æ¢æ— æ³•ç›´æ¥è·å–çš„package" class="headerlink" title="ä½¿ç”¨replaceæ›¿æ¢æ— æ³•ç›´æ¥è·å–çš„package"></a>ä½¿ç”¨replaceæ›¿æ¢æ— æ³•ç›´æ¥è·å–çš„package</h3><p>ç”±äºæŸäº›å·²çŸ¥çš„åŸå› ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„packageéƒ½èƒ½æˆåŠŸä¸‹è½½ï¼Œæ¯”å¦‚ï¼šgolang.orgä¸‹çš„åŒ…ã€‚</p><p>modules å¯ä»¥é€šè¿‡åœ¨ go.mod æ–‡ä»¶ä¸­ä½¿ç”¨ replace æŒ‡ä»¤æ›¿æ¢æˆgithubä¸Šå¯¹åº”çš„åº“ï¼Œæ¯”å¦‚ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">replace <span class="token punctuation">(</span>golang<span class="token punctuation">.</span>org<span class="token operator">/</span>x<span class="token operator">/</span>crypto v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20190313024323</span><span class="token operator">-</span>a1f597ede03a <span class="token operator">=</span><span class="token operator">&gt;</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>golang<span class="token operator">/</span>crypto v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20190313024323</span><span class="token operator">-</span>a1f597ede03a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="go-modå‘å¸ƒå’Œä½¿ç”¨"><a href="#go-modå‘å¸ƒå’Œä½¿ç”¨" class="headerlink" title="go modå‘å¸ƒå’Œä½¿ç”¨"></a>go modå‘å¸ƒå’Œä½¿ç”¨</h3><p>å‚è€ƒRoberto Selbachå†™çš„go modå…¥é—¨æ–‡ç« ï¼Œæ–‡æœ«ï¼Œæˆ‘ç»™å‡ºé“¾æ¥</p><h3 id="Creating-a-Module"><a href="#Creating-a-Module" class="headerlink" title="Creating a Module"></a>Creating a Module</h3><p>å¦‚æœä½ è®¾ç½®å¥½go modäº†ï¼Œé‚£ä½ å°±å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹éšä¾¿åˆ›å»º</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$mkdir</span> gomodone<span class="token variable">$cd</span> gomodone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>say.go</code></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> gomodone<span class="token keyword">import</span> <span class="token string">"fmt"</span> <span class="token comment">// say Hi to someone</span><span class="token keyword">func</span> <span class="token function">SayHi</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Hi, %s"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆå§‹åŒ–ä¸€ä¸ª <code>go.mod</code>æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ go mod init github.com/jacksonyoudi/gomodonego: creating new go.mod: module github.com/jacksonyoudi/gomodone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ go.modå†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">github<span class="token punctuation">.</span>com<span class="token operator">/</span>jacksonyoudi<span class="token operator">/</span>gomodone<span class="token keyword">go</span> <span class="token number">1.14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸‹é¢æˆ‘ä»¬è¦å°†è¿™ä¸ªmoduleå‘å¸ƒåˆ°githubä¸Šï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªç¨‹åºä½¿ç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$git</span> init<span class="token variable">$vim</span> .gitiiignore<span class="token variable">$git</span> commit -am <span class="token string">"init"</span>// githubåˆ›å»ºå¯¹åº”çš„repo<span class="token variable">$git</span> remote <span class="token function">add</span> origin git@github.com:jacksonyoudi/gomodone.git<span class="token variable">$git</span> push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œå®Œï¼Œä¸Šé¢æˆ‘ä»¬å°±ç›¸å½“äºå‘å¸ƒå®Œäº†ã€‚</p><p>å¦‚æœæœ‰äººéœ€è¦ä½¿ç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get github.com/jacksonyoudi/gomodone<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªæ—¶å€™æ²¡æœ‰åŠ tagï¼Œæ‰€ä»¥ï¼Œæ²¡æœ‰ç‰ˆæœ¬çš„æ§åˆ¶ã€‚é»˜è®¤æ˜¯v0.0.0åé¢æ¥ä¸Šæ—¶é—´å’Œcommitidã€‚å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gomodone@v0.0.0-20200517004046-ee882713fd1e<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®˜æ–¹ä¸å»ºè®®è¿™æ ·åšï¼Œæ²¡æœ‰è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ç®¡ç†ã€‚</p><h3 id="module-versioning"><a href="#module-versioning" class="headerlink" title="module versioning"></a>module versioning</h3><p>ä½¿ç”¨tagï¼Œè¿›è¡Œç‰ˆæœ¬æ§åˆ¶</p><h4 id="making-a-release"><a href="#making-a-release" class="headerlink" title="making a release"></a>making a release</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> tag v1.0.0<span class="token function">git</span> push --tags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ“ä½œå®Œï¼Œæˆ‘ä»¬çš„moduleå°±å‘å¸ƒäº†ä¸€ä¸ªv1.0.0çš„ç‰ˆæœ¬äº†ã€‚</p><p>æ¨èåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå†åˆ‡å‡ºä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨äºåç»­v1.0.0çš„ä¿®å¤æ¨é€,ä¸è¦ç›´æ¥åœ¨masteråˆ†æ”¯ä¿®å¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$git</span> checkout -b v1<span class="token variable">$git</span> push -u origin v1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="use-our-module"><a href="#use-our-module" class="headerlink" title="use our module"></a>use our module</h3><p>ä¸Šé¢å·²ç»å‘å¸ƒäº†ä¸€ä¸ªv1.0.0çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªgoçš„é¡¹ç›®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$mkdir</span> Gone<span class="token variable">$cd</span> Gone<span class="token variable">$vim</span> main.go<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"github.com/jacksonyoudi/gomodone"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gomodone<span class="token punctuation">.</span><span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token string">"Roberto"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç å†™å¥½äº†ï¼Œæˆ‘ä»¬ç”Ÿæˆ go modæ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go mod init Gone<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šé¢å‘½ä»¤æ‰§è¡Œå®Œï¼Œä¼šç”Ÿæˆ go modæ–‡ä»¶<br>çœ‹ä¸‹modæ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">module Gonego <span class="token number">1.14</span>require <span class="token punctuation">(</span>github.com/jacksonyoudi/gomodone v1.0.0<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$go</span> mod tidygo: finding module <span class="token keyword">for</span> package github.com/jacksonyoudi/gomodonego: found github.com/jacksonyoudi/gomodone <span class="token keyword">in</span> github.com/jacksonyoudi/gomodone v1.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶è¿˜ç”Ÿæˆäº†go.sum, å…¶ä¸­åŒ…å«è½¯ä»¶åŒ…çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å…·æœ‰æ­£ç¡®çš„ç‰ˆæœ¬å’Œæ–‡ä»¶ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">github.com/jacksonyoudi/gomodone v1.0.1 h1:jFd+qZlAB0R3zqrC9kwO8IgPrAdayMUS0rSHMDc/uG8<span class="token operator">=</span>github.com/jacksonyoudi/gomodone v1.0.1/go.mod h1:XWi+BLbuiuC2YM8Qz4yQzTSPtHt3T3hrlNN2pNlyA94<span class="token operator">=</span>github.com/jacksonyoudi/gomodone/v2 v2.0.0 h1:GpzGeXCx/Xv2ueiZJ8hEhFwLu7xjxLBjkOYSmg8Ya/w<span class="token operator">=</span>github.com/jacksonyoudi/gomodone/v2 v2.0.0/go.mod h1:L8uFPSZNHoAhpaePWUfKmGinjufYdw9c2i70xtBorSw<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªå†…å®¹æ˜¯ä¸‹é¢çš„ï¼Œéœ€è¦æ“ä½œæ‰§è¡Œçš„ç»“æœ</p><p>go run main.goå°±å¯ä»¥è¿è¡Œäº†</p><h3 id="Making-a-bugfix-release"><a href="#Making-a-bugfix-release" class="headerlink" title="Making a bugfix release"></a>Making a bugfix release</h3><p>å‡å¦‚fixä¸€ä¸ªbug,æˆ‘ä»¬åœ¨v1ç‰ˆæœ¬ä¸Šè¿›è¡Œä¿®å¤</p><p>ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// say Hi to someone</span><span class="token keyword">func</span> <span class="token function">SayHi</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token operator">-</span>       <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Hi, %s"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token operator">+</span>       <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Hi, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®å¤å¥½ï¼Œæˆ‘ä»¬å¼€å§‹push</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> commit -m <span class="token string">"Emphasize our friendliness"</span> say.go$ <span class="token function">git</span> tag v1.0.1$ <span class="token function">git</span> push --tags origin v1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="Updating-modules"><a href="#Updating-modules" class="headerlink" title="Updating modules"></a>Updating modules</h4><p>åˆšæ‰fix bugï¼Œæ‰€ä»¥è¦åœ¨æˆ‘ä»¬ä½¿ç”¨é¡¹ç›®ä¸­æ›´æ–°</p><p>è¿™ä¸ªéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œæ›´æ–°moduleæ“ä½œ</p><p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æˆ‘ä»¬çš„å¥½æœ‹å‹æ¥åšåˆ°è¿™ä¸€ç‚¹go getï¼š</p><ul><li>è¿è¡Œ  <code>go get -u</code> ä»¥ä½¿ç”¨æœ€æ–°çš„  minor  ç‰ˆæœ¬æˆ–ä¿®è¡¥ç¨‹åºç‰ˆæœ¬ï¼ˆå³å®ƒå°†ä»1.0.0æ›´æ–°åˆ°ä¾‹å¦‚1.0.1ï¼Œæˆ–è€…ï¼Œå¦‚æœå¯ç”¨ï¼Œåˆ™æ›´æ–°ä¸º1.1.0ï¼‰</li><li>è¿è¡Œ  go get -u=patch ä»¥ä½¿ç”¨æœ€æ–°çš„  ä¿®è¡¥ç¨‹åº  ç‰ˆæœ¬ï¼ˆå³ï¼Œå°†æ›´æ–°ä¸º1.0.1ä½†ä¸æ›´æ–°  ä¸º1.1.0ï¼‰</li><li>è¿è¡Œgo get package@version ä»¥æ›´æ–°åˆ°ç‰¹å®šç‰ˆæœ¬ï¼ˆä¾‹å¦‚github.com/jacksonyoudi/<a href="mailto:gomodone@v1.0.1">gomodone@v1.0.1</a>ï¼‰</li></ul><p>ç›®å‰moduleæœ€æ–°çš„ä¹Ÿæ˜¯v1.0.1</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// æ›´æ–°æœ€æ–°<span class="token variable">$go</span> get -u<span class="token variable">$go</span> get -u<span class="token operator">=</span>patch//æŒ‡å®šåŒ…ï¼ŒæŒ‡å®šç‰ˆæœ¬<span class="token variable">$go</span> get github.com/jacksonyoudi/gomodone@v1.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ“ä½œå®Œï¼Œgo.modæ–‡ä»¶ä¼šä¿®æ”¹å¦‚ä¸‹:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">module Gone<span class="token keyword">go</span> <span class="token number">1.14</span>require <span class="token punctuation">(</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>jacksonyoudi<span class="token operator">/</span>gomodone v1<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Major-versions"><a href="#Major-versions" class="headerlink" title="Major versions"></a>Major versions</h4><p>æ ¹æ®è¯­ä¹‰ç‰ˆæœ¬è¯­ä¹‰ï¼Œä¸»è¦ç‰ˆæœ¬ä¸æ¬¡è¦ç‰ˆæœ¬  ä¸åŒã€‚ä¸»è¦ç‰ˆæœ¬å¯èƒ½ä¼šç ´åå‘åå…¼å®¹æ€§ã€‚ä»Goæ¨¡å—çš„è§’åº¦æ¥çœ‹ï¼Œä¸»è¦ç‰ˆæœ¬æ˜¯  å®Œå…¨ä¸åŒçš„è½¯ä»¶åŒ…ã€‚ä¹ä¸€çœ‹è¿™å¬èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†è¿™æ˜¯æœ‰é“ç†çš„ï¼šä¸¤ä¸ªä¸å…¼å®¹çš„åº“ç‰ˆæœ¬æ˜¯ä¸¤ä¸ªä¸åŒçš„åº“ã€‚<br>æ¯”å¦‚ä¸‹é¢ä¿®æ”¹ï¼Œå®Œå…¨ç ´åäº†å…¼å®¹æ€§ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> gomodone<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"errors"</span><span class="token string">"fmt"</span><span class="token punctuation">)</span><span class="token comment">// Hi returns a friendly greeting</span><span class="token comment">// Hi returns a friendly greeting in language lang</span><span class="token keyword">func</span> <span class="token function">SayHi</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> lang <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">switch</span> lang <span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token string">"en"</span><span class="token punctuation">:</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Hi, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token keyword">case</span> <span class="token string">"pt"</span><span class="token punctuation">:</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Oi, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token keyword">case</span> <span class="token string">"es"</span><span class="token punctuation">:</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Â¡Hola, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token keyword">case</span> <span class="token string">"fr"</span><span class="token punctuation">:</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Bonjour, %s!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token keyword">default</span><span class="token punctuation">:</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"unknown language"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸åŒçš„å¤§ç‰ˆæœ¬ï¼Œè¿™ç§æƒ…å†µä¸‹</p><p>ä¿®æ”¹ go.modå¦‚ä¸‹</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">module github<span class="token punctuation">.</span>com<span class="token operator">/</span>jacksonyoudi<span class="token operator">/</span>gomodone<span class="token operator">/</span>v2<span class="token keyword">go</span> <span class="token number">1.14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶åï¼Œé‡æ–°tagï¼Œpush</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> commit say.go -m <span class="token string">"Change Hi to allow multilang"</span>$ <span class="token function">git</span> checkout -b v2 <span class="token comment"># ç”¨äºv2ç‰ˆæœ¬ï¼Œåç»­ä¿®å¤v2</span>$ <span class="token function">git</span> commit go.mod -m <span class="token string">"Bump version to v2"</span>$ <span class="token function">git</span> tag v2.0.0$ <span class="token function">git</span> push --tags origin v2 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Updating-to-a-major-version"><a href="#Updating-to-a-major-version" class="headerlink" title="Updating to a major version"></a>Updating to a major version</h3><p>å³ä½¿å‘å¸ƒäº†åº“çš„æ–°ä¸å…¼å®¹ç‰ˆæœ¬ï¼Œç°æœ‰è½¯ä»¶ ä¹Ÿä¸ä¼šä¸­æ–­ï¼Œå› ä¸ºå®ƒå°†ç»§ç»­ä½¿ç”¨ç°æœ‰ç‰ˆæœ¬1.0.1ã€‚go get -u å°†ä¸ä¼šè·å¾—ç‰ˆæœ¬2.0.0ã€‚<br>å¦‚æœæƒ³ä½¿ç”¨v2.0.0,ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span>    <span class="token string">"github.com/jacksonyoudi/gomodone/v2"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>g<span class="token punctuation">,</span> err <span class="token operator">:=</span> gomodone<span class="token punctuation">.</span><span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token string">"Roberto"</span><span class="token punctuation">,</span> <span class="token string">"pt"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œ go mod tidy</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go: finding module <span class="token keyword">for</span> package github.com/jacksonyoudi/gomodone/v2go: downloading github.com/jacksonyoudi/gomodone/v2 v2.0.0go: found github.com/jacksonyoudi/gomodone/v2 <span class="token keyword">in</span> github.com/jacksonyoudi/gomodone/v2 v2.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶ï¼Œä¸¤ä¸ªç‰ˆæœ¬éƒ½å¯ä»¥åŒæ—¶ä½¿ç”¨, ä½¿ç”¨åˆ«å<br>å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"github.com/jacksonyoudi/gomodone"</span>mv2 <span class="token string">"github.com/jacksonyoudi/gomodone/v2"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>g<span class="token punctuation">,</span> err <span class="token operator">:=</span> mv2<span class="token punctuation">.</span><span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token string">"Roberto"</span><span class="token punctuation">,</span> <span class="token string">"pt"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gomodone<span class="token punctuation">.</span><span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token string">"Roberto"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œä¸€ä¸‹ <code>go mod tidy</code></p><h3 id="Vendoring"><a href="#Vendoring" class="headerlink" title="Vendoring"></a>Vendoring</h3><p>é»˜è®¤æ˜¯å¿½ç•¥vendorçš„ï¼Œå¦‚æœæƒ³åœ¨é¡¹ç›®ç›®å½•ä¸‹æœ‰vendorå¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">$go vendor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“ç„¶ï¼Œå¦‚æœæ„å»ºç¨‹åºçš„æ—¶å€™ï¼Œå¸Œæœ›ä½¿ç”¨vendorä¸­çš„ä¾èµ–ï¼Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">$ <span class="token keyword">go</span> build <span class="token operator">-</span>mod vendor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="IDEAä¸‹å¼€å‘GO"><a href="#IDEAä¸‹å¼€å‘GO" class="headerlink" title="IDEAä¸‹å¼€å‘GO"></a>IDEAä¸‹å¼€å‘GO</h3><ol><li>åˆ›å»ºgoé¡¹ç›®</li></ol><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/IqR0yI.jpg"></p><ol start="2"><li><p>åˆ›å»ºå®Œé¡¹ç›®ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆgo modæ–‡ä»¶<br>å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ï¼ŒåŠ å…¥gitç­‰æ“ä½œ</p></li><li><p>å†™ä¸šåŠ¡é€»è¾‘ä»£ç </p></li></ol><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/ZNN4tE.jpg"><br>4. è§£å†³ä¾èµ–ï¼Œæ›´æ–°go.mod</p><p><img src="https://raw.githubusercontent.com/jacksonyoudi/images/main/uPic/CxoGM9.jpg"></p><ol start="5"><li>go build</li></ol>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> tool </tag>
            
            <tag> language </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
